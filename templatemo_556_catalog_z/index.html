<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MovieDck</title>
  <!-- Google Fonts for classy branding -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=DM+Serif+Display&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* Your existing styles unchanged (omitted here for brevity) */
    /* ... */
    body {
      background: #15191e;
      color: #eee;
      font-family: 'Montserrat', Arial, sans-serif;
      overflow-y: auto;
    }
    .modal, .modal-content {
      -webkit-overflow-scrolling: touch;
      overflow-y: auto;
    }
  </style>
  <script type="text/javascript" data-cfasync="false">
    /* Existing anti-ad script unchanged */
    /* ... */
  </script>
</head>
<body>
  <!-- Your existing HTML content unchanged (omitted here for brevity) -->
  <!-- ... -->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script>
  <script>
    // --- CONFIG ---
    const apiKey = '40f1982842db35042e8561b13b38d492';
    const imageBaseUrl = 'https://image.tmdb.org/t/p/w500';
    let lastModalMovie = null;
    let currentPage = 1;
    let totalPages = 1;
    let currentMode = "popular";
    let currentQuery = "";
    let favorites = JSON.parse(localStorage.getItem('favorites') || "[]");
    let netflixType = "movie"; // "movie" or "tv"
    let tvModalData = { tvId: null, season: null, episode: null, seasons: [] };
    let categoryItems = []; // Store the full list of items for the current category
    let isLoading = false;
    let reachedEnd = false;

    let lastScrollTop = 0;

    function isMobileOrTablet() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
             window.matchMedia("(max-width: 991.98px)").matches;
    }

    function handleFullscreenOrientation(iframe) {
      if (!isMobileOrTablet()) return;
      const lockOrientation = () => {
        if (document.fullscreenElement === iframe && screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(() => {
            const modalBody = iframe.closest('.modal-content').querySelector('.modal-body');
            if (!modalBody.querySelector('.error-state')) {
              const errorMsg = document.createElement('p');
              errorMsg.className = 'error-state';
              errorMsg.textContent = 'Please rotate your device to landscape for the best fullscreen experience.';
              errorMsg.style.marginTop = '1rem';
              modalBody.appendChild(errorMsg);
              setTimeout(() => errorMsg.remove(), 5000);
            }
          });
        }
      };
      const unlockOrientation = () => {
        if (screen.orientation && screen.orientation.unlock) {
          screen.orientation.unlock().catch(() => {});
        }
      };
      iframe.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement === iframe) {
          lockOrientation();
          lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
          document.body.style.overflow = 'hidden';
        } else {
          unlockOrientation();
          document.body.style.overflow = '';
          window.scrollTo(0, lastScrollTop);
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const modalVideo = document.getElementById('modal-video');
      const tvEpisodePlayer = document.getElementById('tv-episode-player');
      if (modalVideo) handleFullscreenOrientation(modalVideo);
      if (tvEpisodePlayer) handleFullscreenOrientation(tvEpisodePlayer);

      // <-- FIX: Load first page of movies on page load -->
      loadMoreMovies(true);
    });

    // Your existing functions (isFavorite, toggleFavorite, renderFavorites, addRecentlyViewed, renderRecentlyViewed, fetchMoviesInf, renderMovies, loadMoreMovies, showDetails, etc.) unchanged
    // Just ensure loadMoreMovies is defined and called as above

    // Example loadMoreMovies function:
    async function loadMoreMovies(clear = false) {
      if (isLoading || reachedEnd) return;
      isLoading = true;
      document.getElementById("infinite-loader").style.display = "";
      const items = await fetchMoviesInf(currentPage);
      if (items.length > 0) {
        if (clear) categoryItems = items;
        else categoryItems = [...categoryItems, ...items];
        renderMovies(items, clear);
        currentPage++;
        if (currentPage > totalPages) reachedEnd = true;
      } else {
        reachedEnd = true;
        if (clear && !items.length) {
          document.getElementById('movie-list').innerHTML = `<div class="empty-state">No items found.</div>`;
        }
      }
      isLoading = false;
      document.getElementById("infinite-loader").style.display = "none";
    }

    // Define fetchMoviesInf, renderMovies, and other functions as in your original code

  </script>
</body>
</html>
