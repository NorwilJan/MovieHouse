<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MovieDck</title>
  <!-- Google Fonts for classy branding -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=DM+Serif+Display&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* Your CSS styles here (same as previous message) */
    /* ... (omitted here for brevity, use the full CSS from previous response) */
    body {
      background: #15191e;
      color: #eee;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    /* ... rest of CSS ... */
  </style>
</head>
<body>
  <!-- All your HTML markup as before (modals, nav, main content, footer) -->
  <!-- ... (same as previous message, omitted here for brevity) -->

  <!-- Back to Top Button -->
  <button id="back-to-top" title="Back to Top" aria-label="Back to Top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <footer class="tm-bg-gray pt-5 pb-3 tm-text-gray tm-footer">
    <!-- footer content as before -->
  </footer>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script>

  <script>
    // --- CONFIG ---
    const apiKey = '40f1982842db35042e8561b13b38d492';
    const imageBaseUrl = 'https://image.tmdb.org/t/p/w500';
    let lastModalMovie = null;
    let currentPage = 1;
    let totalPages = 1;
    let currentMode = 'popular';
    let currentQuery = '';
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let netflixType = 'movie'; // "movie" or "tv"
    let tvModalData = { tvId: null, season: null, episode: null, seasons: [] };
    let categoryItems = []; // Store the full list of items for the current category
    let isLoading = false;
    let reachedEnd = false;
    let recentlyViewed = JSON.parse(localStorage.getItem('recently_viewed') || '[]');

    // Check if device is mobile or tablet
    function isMobileOrTablet() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
        window.matchMedia('(max-width: 991.98px)').matches;
    }

    // Handle orientation lock for fullscreen
    function handleFullscreenOrientation(iframe) {
      if (!isMobileOrTablet()) return; // Skip for desktop
      const lockOrientation = () => {
        if (document.fullscreenElement === iframe && screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch((err) => {
            console.warn('Orientation lock failed:', err);
            const modalBody = iframe.closest('.modal-content').querySelector('.modal-body');
            const errorMsg = document.createElement('p');
            errorMsg.className = 'error-state';
            errorMsg.textContent = 'Please rotate your device to landscape for the best fullscreen experience.';
            errorMsg.style.marginTop = '1rem';
            if (!modalBody.querySelector('.error-state')) {
              modalBody.appendChild(errorMsg);
              setTimeout(() => errorMsg.remove(), 5000);
            }
          });
        }
      };
      const unlockOrientation = () => {
        if (screen.orientation && screen.orientation.unlock) {
          screen.orientation.unlock().catch((err) => console.warn('Orientation unlock failed:', err));
        }
      };
      iframe.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement === iframe) {
          lockOrientation();
        } else {
          unlockOrientation();
        }
      });
    }

    // FAVORITES/RECENTLY VIEWED
    function isFavorite(id, media_type) {
      return favorites.some((f) => f.id === id && f.media_type === media_type);
    }
    function toggleFavorite(id, media_type) {
      if (isFavorite(id, media_type)) {
        favorites = favorites.filter((f) => f.id !== id || f.media_type !== media_type);
      } else {
        favorites.push({ id, media_type });
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      if (currentMode === 'favorites') renderFavorites();
      // Update favorite buttons in movie list
      document.querySelectorAll('.favorite-btn').forEach((btn) => {
        if (
          btn.closest('.movie-col') &&
          btn.closest('.movie-col').innerHTML.includes(`${media_type}/${id}`)
        ) {
          if (isFavorite(id, media_type)) btn.classList.add('favorited');
          else btn.classList.remove('favorited');
        }
      });
      // Update favorite button in TV modal
      const tvFavoriteBtn = document.getElementById('tv-favorite-btn');
      if (tvFavoriteBtn && tvModalData.tvId === id && media_type === 'tv') {
        if (isFavorite(id, 'tv')) tvFavoriteBtn.classList.add('favorited');
        else tvFavoriteBtn.classList.remove('favorited');
      }
    }
    function renderFavorites() {
      if (!favorites.length) {
        document.getElementById('movie-list').innerHTML = `<div class="empty-state">You have no favorite movies or TV shows yet ❤️.</div>`;
        return;
      }
      Promise.all(
        favorites.map((item) =>
          fetch(`https://api.themoviedb.org/3/${item.media_type}/${item.id}?api_key=${apiKey}`)
            .then((r) => r.json())
            .then((data) => ({ ...data, media_type: item.media_type }))
        )
      )
        .then((arr) => {
          categoryItems = arr.filter((m) => m && m.id); // Store for category search
          renderMovies(categoryItems, true);
        })
        .catch((err) => {
          console.error('Error fetching favorites:', err);
          document.getElementById('movie-list').innerHTML = `<div class="error-state">Failed to load favorites. Please try again.</div>`;
        });
    }
    function addRecentlyViewed(item) {
      const isTv = !!item.name && !item.title;
      recentlyViewed = recentlyViewed.filter((m) => m.id !== item.id || m.media_type !== (isTv ? 'tv' : 'movie'));
      recentlyViewed.unshift({
        id: item.id,
        title: item.title || item.name,
        poster_path: item.poster_path,
        release_date: item.release_date || item.first_air_date,
        media_type: isTv ? 'tv' : 'movie',
      });
      if (recentlyViewed.length > 12) recentlyViewed = recentlyViewed.slice(0, 12);
      localStorage.setItem('recently_viewed', JSON.stringify(recentlyViewed));
      renderRecentlyViewed();
    }
    function renderRecentlyViewed() {
      const section = document.getElementById('recently-viewed-section');
      const list = document.getElementById('recently-viewed-list');
      if (!recentlyViewed.length) {
        section.style.display = 'none';
        return;
      }
      section.style.display = '';
      list.innerHTML = '';
      recentlyViewed.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'movie-col';
        div.innerHTML = `
          <div class="movie-poster-wrapper" tabindex="0">
            <img loading="lazy" src="${item.poster_path ? imageBaseUrl + item.poster_path : 'img/no-poster.png'}" alt="${item.title}" class="img-fluid movie-poster-img" />
          </div>
          <div class="movie-metadata">
            <span class="movie-title" title="${item.title}">${item.title}</span>
            <span class="movie-year">${item.release_date ? item.release_date.slice(0, 4) : ''}</span>
          </div>
        `;
        div.onclick = () => {
          fetch(`https://api.themoviedb.org/3/${item.media_type}/${item.id}?api_key=${apiKey}`)
            .then((r) => r.json())
            .then((data) => {
              if (item.media_type === 'tv') showTvDetails(data);
              else showDetails(data);
            });
        };
        list.appendChild(div);
      });
    }

    // FETCH & RENDER
    async function fetchMoviesInf(page = 1) {
      let url = '';
      if (currentMode === 'favorites') {
        renderFavorites();
        return [];
      }
      if (currentMode === 'search' && currentQuery.trim()) {
        url = `https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${encodeURIComponent(
          currentQuery
        )}&page=${page}&include_adult=false`;
      } else if (currentMode === 'anime') {
        url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_genres=16&with_original_language=ja&sort_by=popularity.desc&page=${page}`;
      } else if (currentMode === 'tagalog') {
        url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_original_language=tl&sort_by=popularity.desc&page=${page}`;
      } else if (currentMode === 'tv') {
        url = `https://api.themoviedb.org/3/trending/tv/day?api_key=${apiKey}&page=${page}`;
      } else if (currentMode === 'netflix') {
        if (netflixType === 'movie') {
          url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_watch_providers=8&watch_region=US&sort_by=popularity.desc&page=${page}`;
        } else {
          url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_watch_providers=8&watch_region=US&sort_by=popularity.desc&page=${page}`;
        }
      } else {
        url = `https://api.themoviedb.org/3/trending/movie/day?api_key=${apiKey}&page=${page}`;
      }
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        totalPages = data.total_pages || 1;
        return data.results || [];
      } catch (e) {
        console.error('Fetch error:', e);
        document.getElementById('movie-list').innerHTML = `<div class="error-state">Failed to load movies/TV shows. Please check your connection.</div>`;
        return [];
      }
    }
    function renderMovies(items, clear = false) {
      const container = document.getElementById('movie-list');
      if (clear) container.innerHTML = '';
      if (!items || items.length === 0) {
        if (clear) container.innerHTML = `<div class="empty-state">No items found for your filter or search.</div>`;
        return;
      }
      items.forEach((item) => {
        const isTv = item.media_type === 'tv' || (!!item.name && !item.title);
        const mediaType = isTv ? 'tv' : 'movie';
        const movieDiv = document.createElement('div');
        movieDiv.className = 'movie-col';
        movieDiv.innerHTML = `
          <div class="movie-poster-wrapper" tabindex="0">
            <img loading="lazy" src="${item.poster_path ? imageBaseUrl + item.poster_path : 'img/no-poster.png'}" alt="${
          isTv ? item.name : item.title
        }" class="img-fluid movie-poster-img" />
            <button class="play-btn-centered" type="button" title="${isTv ? 'View TV Show' : 'Play Movie'}">
              <i class="fas fa-${isTv ? 'tv' : 'play'}"></i>
            </button>
            <button class="favorite-btn${isFavorite(item.id, mediaType) ? ' favorited' : ''}" title="Add to favorites" aria-label="Add to favorites" tabindex="0">
              <i class="fas fa-heart"></i>
            </button>
          </div>
          <div class="movie-metadata">
            <span class="movie-title" title="${isTv ? item.name : item.title}">${isTv ? item.name : item.title}</span>
            <span class="movie-year">${
              (isTv ? item.first_air_date : item.release_date) ? (isTv ? item.first_air_date : item.release_date).slice(0, 4) : ''
            }</span>
            ${isTv ? '<span class="movie-type" style="font-size: 0.9em; color: #1976d2;">TV Show</span>' : ''}
          </div>
        `;
        movieDiv.querySelector('.play-btn-centered').onclick = () => {
          isTv ? showTvDetails(item) : showDetails(item);
        };
        movieDiv.querySelector('.favorite-btn').onclick = (e) => {
          e.stopPropagation();
          toggleFavorite(item.id, mediaType);
        };
        container.appendChild(movieDiv);
      });
    }

    // Infinite scroll
    async function loadMoreMovies(clear = false) {
      if (isLoading || reachedEnd) return;
      isLoading = true;
      document.getElementById('infinite-loader').style.display = '';
      const items = await fetchMoviesInf(currentPage);
      if (items.length > 0) {
        if (clear) categoryItems = items;
        else categoryItems = [...categoryItems, ...items];
        renderMovies(items, clear);
        currentPage++;
        if (currentPage > totalPages) reachedEnd = true;
      } else {
        reachedEnd = true;
        if (clear && !items.length) {
          document.getElementById('movie-list').innerHTML = `<div class="empty-state">No items found.</div>`;
        }
      }
      isLoading = false;
      document.getElementById('infinite-loader').style.display = 'none';
    }

    // MODAL - MOVIE
    async function showDetails(movie) {
      document.getElementById('modal-content-movie').style.display = '';
      document.getElementById('modal-content-tv').style.display = 'none';
      document.getElementById('modal').style.display = 'flex';
      lastModalMovie = movie;
      addRecentlyViewed(movie);
      document.getElementById('modal-title').textContent = movie.title;
      document.getElementById('modal-description').textContent = movie.overview || '';
      document.getElementById('modal-image').src = movie.poster_path ? imageBaseUrl + movie.poster_path : 'img/no-poster.png';
      document.getElementById('modal-rating').innerHTML = getStars(movie.vote_average || 0) + ` (${movie.vote_average || 'N/A'})`;
      document.getElementById('modal-genres').innerHTML = (movie.genre_ids || movie.genres || [])
        .map((gid) => {
          let g = typeof gid === 'object' ? gid : (window.genreList || []).find((x) => x.id === gid) || { name: '' };
          return g.name ? `<span class="chip">${g.name}</span>` : '';
        })
        .join(' ');
      document.getElementById('modal-cast').textContent = 'Loading cast...';
      document.getElementById('modal-crew').textContent = '';
      document.getElementById('modal-trailer').innerHTML = '';
      document.getElementById('similar-movies').innerHTML = '';
      fetch(`https://api.themoviedb.org/3/movie/${movie.id}/credits?api_key=${apiKey}`)
        .then((r) => r.json())
        .then((data) => {
          let cast = (data.cast || [])
            .slice(0, 5)
            .map((c) => c.name)
            .join(', ');
          let director = (data.crew || []).find((c) => c.job === 'Director');
          document.getElementById('modal-cast').innerHTML = cast ? `<strong>Cast:</strong> ${cast}` : '';
          document.getElementById('modal-crew').innerHTML = director ? `<strong>Director:</strong> ${director.name}` : '';
        });
      fetch(`https://api.themoviedb.org/3/movie/${movie.id}/videos?api_key=${apiKey}`)
        .then((r) => r.json())
        .then((data) => {
          let yt = (data.results || []).find((v) => v.site === 'YouTube' && v.type === 'Trailer');
          if (yt)
            document.getElementById('modal-trailer').innerHTML = `<a href="https://youtube.com/watch?v=${yt.key}" target="_blank" rel="noopener">▶ Watch Official Trailer</a>`;
        });
      document.getElementById('server').value = 'player.videasy.net';
      changeServer(true); // Enable auto-redirect on initial load
      fetch(`https://api.themoviedb.org/3/movie/${movie.id}/similar?api_key=${apiKey}`)
        .then((r) => r.json())
        .then((data) => {
          if (data && data.results && data.results.length) {
            let html = `<div style="margin-top: 1.3em;"><b>Similar Movies:</b><div style="display: flex; gap: 1em; overflow-x: auto; padding-top: 0.7em;">`;
            data.results.slice(0, 8).forEach((m) => {
              html += `<div style="width: 110px; text-align: center;">
                <img src="${
                  m.poster_path ? imageBaseUrl + m.poster_path : 'img/no-poster.png'
                }" alt="${m.title}" style="width: 100px; border-radius: 7px; cursor: pointer;" onclick="showDetailsFromId(${m.id})" />
                <div style="font-size: 0.93em; margin-top: 0.3em;">${m.title}</div>
              </div>`;
            });
            html += `</div></div>`;
            document.getElementById('similar-movies').innerHTML = html;
          }
        });
    }
    window.showDetailsFromId = function (id) {
      fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${apiKey}`)
        .then((r) => r.json())
        .then(showDetails);
    };
    function getStars(vote) {
      let stars = Math.round((vote || 0) / 2);
      return '★'.repeat(stars) + '☆'.repeat(5 - stars);
    }
    function resetIframeForVidsrc(iframe, embedURL, playOverlay) {
      iframe.src = '';
      setTimeout(() => {
        iframe.src = embedURL;
        iframe.onload = function () {
          try {
            iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
            playOverlay.style.display = 'none';
          } catch (e) {
            console.warn('Auto-play failed after reset:', e);
            playOverlay.style.display = 'flex';
            const modalBody = iframe.closest('.modal-content').querySelector('.modal-body');
            const errorMsg = document.createElement('p');
            errorMsg.className = 'error-state';
            errorMsg.textContent = 'Auto-play blocked or server unavailable. Click the play button to start the video.';
            errorMsg.style.marginTop = '1rem';
            if (!modalBody.querySelector('.error-state')) {
              modalBody.appendChild(errorMsg);
              setTimeout(() => errorMsg.remove(), 5000);
            }
          }
        };
      }, 100);
    }
    function changeServer(auto = false) {
      if (!lastModalMovie) return;
      const serverSelect = document.getElementById('server');
      const iframe = document.getElementById('modal-video');
      const playOverlay = iframe.parentElement.querySelector('.iframe-play-overlay');
      const servers = ['player.videasy.net', 'vidsrc.cc', 'vidsrc.me', 'vidsrc.to'];
      let currentServer = serverSelect.value;
      let movieId = lastModalMovie.id;
      let embedURL = '';

      function tryNextServer(index) {
        if (index >= servers.length) {
          playOverlay.style.display = 'flex';
          const modalBody = document.getElementById('modal-content-movie').querySelector('.modal-body');
          const errorMsg = document.createElement('p');
          errorMsg.className = 'error-state';
          errorMsg.textContent = 'All servers are unavailable. Try again later.';
          errorMsg.style.marginTop = '1rem';
          if (!modalBody.querySelector('.error-state')) {
            modalBody.appendChild(errorMsg);
            setTimeout(() => errorMsg.remove(), 5000);
          }
          return;
        }

        const server = servers[index];
        serverSelect.value = server;
        if (server === 'player.videasy.net') {
          embedURL = `https://player.videasy.net/movie/${movieId}?autoplay=1`;
        } else if (server === 'vidsrc.cc') {
          embedURL = `https://vidsrc.cc/api/embed/movie/${movieId}?autoplay=1`;
        } else if (server === 'vidsrc.me') {
          embedURL = `https://vidsrc.me/api/embed/movie/${movieId}?autoplay=1`;
        } else if (server === 'vidsrc.to') {
          embedURL = `https://vidsrc.to/api/embed/movie/${movieId}?autoplay=1`;
        }
        iframe.src = embedURL;
        iframe.onload = () => {
          playOverlay.style.display = 'none';
        };
        iframe.onerror = () => {
          tryNextServer(index + 1);
        };
      }

      if (auto) {
        tryNextServer(servers.indexOf(currentServer));
      } else {
        iframe.src = '';
        playOverlay.style.display = 'flex';
      }
    }
    function triggerIframePlay(id) {
      const iframe = document.getElementById(id);
      const playOverlay = iframe.parentElement.querySelector('.iframe-play-overlay');
      try {
        iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
        playOverlay.style.display = 'none';
      } catch (e) {
        console.warn('Play command failed:', e);
      }
    }
    function closeModal() {
      document.getElementById('modal').style.display = 'none';
      const iframe = document.getElementById('modal-video');
      iframe.src = '';
      lastModalMovie = null;
    }
    function closeTvModal() {
      document.getElementById('modal').style.display = 'none';
      const iframe = document.getElementById('tv-episode-player');
      iframe.src = '';
      tvModalData = { tvId: null, season: null, episode: null, seasons: [] };
    }

    // Scroll handling for infinite scroll and back to top button
    window.addEventListener('scroll', () => {
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      // Show back to top button after 300px scroll
      const backToTop = document.getElementById('back-to-top');
      if (scrollTop > 300) {
        backToTop.classList.add('visible');
      } else {
        backToTop.classList.remove('visible');
      }
      // Infinite scroll trigger near bottom
      if (
        window.innerHeight + scrollTop >=
        document.documentElement.scrollHeight - 300
      ) {
        loadMoreMovies();
      }
    });

    document.getElementById('back-to-top').addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Prevent default on links with href="#"
    document.querySelectorAll('a[href="#"]').forEach((link) => {
      link.addEventListener('click', (e) => e.preventDefault());
    });

    // Navigation links event handlers
    document.getElementById('nav-movies').addEventListener('click', (e) => {
      e.preventDefault();
      if (currentMode !== 'popular') {
        currentMode = 'popular';
        currentPage = 1;
        reachedEnd = false;
        document.getElementById('section-title').textContent = 'Trending Movies';
        document.getElementById('category-search-form').style.display = 'none';
        categoryItems = [];
        loadMoreMovies(true);
        setActiveNav('nav-movies');
      }
    });
    document.getElementById('nav-tvshows').addEventListener('click', (e) => {
      e.preventDefault();
      if (currentMode !== 'tv') {
        currentMode = 'tv';
        currentPage = 1;
        reachedEnd = false;
        document.getElementById('section-title').textContent = 'Trending TV Shows';
        document.getElementById('category-search-form').style.display = 'none';
        categoryItems = [];
        loadMoreMovies(true);
        setActiveNav('nav-tvshows');
      }
    });
    document.getElementById('nav-anime').addEventListener('click', (e) => {
      e.preventDefault();
      if (currentMode !== 'anime') {
        currentMode = 'anime';
        currentPage = 1;
        reachedEnd = false;
        document.getElementById('section-title').textContent = 'Trending Anime Movies';
        document.getElementById('category-search-form').style.display = 'none';
        categoryItems = [];
        loadMoreMovies(true);
        setActiveNav('nav-anime');
      }
    });
    document.getElementById('nav-tagalog').addEventListener('click', (e) => {
      e.preventDefault();
      if (currentMode !== 'tagalog') {
        currentMode = 'tagalog';
        currentPage = 1;
        reachedEnd = false;
        document.getElementById('section-title').textContent = 'Trending Tagalog Movies';
        document.getElementById('category-search-form').style.display = 'none';
        categoryItems = [];
        loadMoreMovies(true);
        setActiveNav('nav-tagalog');
      }
    });
    document.getElementById('nav-netflix').addEventListener('click', (e) => {
      e.preventDefault();
      if (currentMode !== 'netflix') {
        currentMode = 'netflix';
        currentPage = 1;
        reachedEnd = false;
        document.getElementById('section-title').textContent = 'Trending Netflix';
        document.getElementById('category-search-form').style.display = 'none';
        categoryItems = [];
        loadMoreMovies(true);
        setActiveNav('nav-netflix');
      }
    });
    document.getElementById('nav-favorites').addEventListener('click', (e) => {
      e.preventDefault();
      if (currentMode !== 'favorites') {
        currentMode = 'favorites';
        currentPage = 1;
        reachedEnd = false;
        document.getElementById('section-title').textContent = 'Favorites';
        document.getElementById('category-search-form').style.display = 'none';
        categoryItems = [];
        renderFavorites();
        setActiveNav('nav-favorites');
      }
    });

    function setActiveNav(id) {
      document.querySelectorAll('#movie-nav .nav-link').forEach((el) => el.classList.remove('active'));
      const activeEl = document.getElementById(id);
      if (activeEl) activeEl.classList.add('active');
    }

    // Search form submission
    document.getElementById('movie-search-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('movie-search-input');
      const query = input.value.trim();
      if (!query) return;
      currentQuery = query;
      currentMode = 'search';
      currentPage = 1;
      reachedEnd = false;
      document.getElementById('section-title').textContent = `Search results for "${query}"`;
      document.getElementById('category-search-form').style.display = 'none';
      categoryItems = [];
      loadMoreMovies(true);
      setActiveNav(null);
    });

    // Category search form (if you want to enable)
    document.getElementById('category-search-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('category-search-input');
      const query = input.value.trim().toLowerCase();
      if (!query) {
        renderMovies(categoryItems, true);
        return;
      }
      const filtered = categoryItems.filter((item) => {
        const title = item.title || item.name || '';
        return title.toLowerCase().includes(query);
      });
      renderMovies(filtered, true);
    });

    // Initial load
    window.onload = () => {
      loadMoreMovies(true);
      renderRecentlyViewed();
    };
  </script>
</body>
</html>
