<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MovieHouse</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background: #15191e;
      color: #eee;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .container-fluid, .tm-container-content {
      background: #15191e !important;
    }
    .navbar, .navbar-nav, .nav-link, .tm-text-primary, .tm-footer, .modal-content, .modal, .tm-search-form, .movie-metadata, .modal-body, .modal-text, .footer, .pagination, .page-link, .chip {
      background: #15191e !important;
      color: #eee !important;
      border-color: #222 !important;
    }
    .tm-hero {
      background: #1a1f25;
    }
    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 0.6em 0;
    }
    .navbar-brand .logo-text {
      font-family: 'DM Serif Display', 'Montserrat', Arial, sans-serif;
      font-size: 2.7rem;
      font-weight: 900;
      letter-spacing: 2px;
      color: #fff;
      text-shadow: 0 2px 18px #1976d2c0, 0 1px 2px #1a2028;
      line-height: 1.1;
    }
    @media (max-width: 991.98px) {
      .navbar-brand .logo-text {
        font-size: 1.8rem;
      }
      .navbar-collapse {
        background: #15191e;
        padding: 1rem;
      }
      .navbar-nav {
        flex-direction: column;
        align-items: flex-start;
      }
      .nav-link {
        padding: 0.5rem 1rem;
        font-size: 1.1rem;
      }
      .navbar-toggler {
        border: none;
        color: #eee;
      }
      .navbar-toggler-icon {
        background-image: none;
      }
      .navbar-toggler i {
        font-size: 1.5rem;
        color: #eee;
      }
    }
    .movie-poster-wrapper, .movie-col {
      background: transparent !important;
      position: relative;
    }
    .movie-poster-img {
      background: #222;
      border: 1px solid #222;
      transition: box-shadow 0.2s;
      border-radius: 6px;
      display: block;
      width: 100%;
    }
    .movie-poster-wrapper:focus-within .movie-poster-img,
    .movie-poster-wrapper:hover .movie-poster-img:not(:hover) {
      box-shadow: 0 8px 32px #1976d2aa, 0 2px 10px #15191e80;
      z-index: 2;
    }
    .movie-poster-img:hover {
      box-shadow: 0 8px 32px #1976d2aa, 0 2px 10px #15191e80;
      z-index: 2;
    }
    .movie-poster-wrapper:hover .play-btn-centered,
    .movie-poster-wrapper:focus-within .play-btn-centered {
      filter: brightness(1.13);
    }
    .movie-poster-wrapper {
      cursor: pointer;
      transition: transform 0.15s;
    }
    .movie-poster-wrapper:hover,
    .movie-poster-wrapper:focus-within {
      transform: translateY(-2px) scale(1.02);
      z-index: 1;
    }
    .play-btn-centered {
      position: absolute;
      left: 50%;
      top: 54%;
      transform: translate(-50%, -50%);
      background: #1976d2 !important;
      color: #fff !important;
      border: none;
      border-radius: 50%;
      width: 46px;
      height: 46px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3;
      opacity: 0.95;
      box-shadow: 0 2px 12px #1976d299;
      transition: background 0.2s, box-shadow 0.2s, transform 0.13s;
    }
    .play-btn-centered:hover, .play-btn-centered:focus {
      background: #2196f3 !important;
      box-shadow: 0 4px 18px #1976d2cc, 0 1px 4px #222;
      transform: translate(-50%, -50%) scale(1.08);
      color: #fff !important;
      outline: none;
    }
    .favorite-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 1.4em;
      color: #fff !important;
      z-index: 4;
      cursor: pointer;
      transition: color 0.15s, text-shadow 0.13s;
      outline: none;
    }
    .favorite-btn.favorited {
      color: #ff3870 !important;
      text-shadow: 0 0 8px #fff, 0 1px 6px #d23f7a;
    }
    .favorite-btn:hover, .favorite-btn:focus {
      color: #ff3870 !important;
    }
    #modal-content-tv .favorite-btn {
      background: transparent;
      border: none;
      font-size: 1.4em;
      color: #fff !important;
      cursor: pointer;
      transition: color 0.15s, text-shadow 0.13s;
      outline: none;
      margin: 0.5em 0;
      display: inline-block;
    }
    #modal-content-tv .favorite-btn.favorited {
      color: #ff3870 !important;
      text-shadow: 0 0 8px #fff, 0 1px 6px #d23f7a;
    }
    #modal-content-tv .favorite-btn:hover,
    #modal-content-tv .favorite-btn:focus {
      color: #ff3870 !important;
    }
    .modal-content {
      background: #23272e !important;
      color: #eee !important;
      max-height: 95vh;
      overflow-y: auto;
      border-radius: 8px;
      max-width: 800px;
      width: 98vw;
      margin: 2vw;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .chip {
      background: #1976d2 !important;
      color: #fff !important;
    }
    .close {
      color: #2196f3 !important;
      position: absolute;
      right: 20px;
      top: 18px;
      font-size: 2em;
      cursor: pointer;
      z-index: 2;
      opacity: 0.7;
    }
    .spinner {
      border-top: 7px solid #1976d2;
      border: 7px solid #222;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1.1s linear infinite;
      margin: 40px auto;
      display: block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .empty-state, .error-state, .loading-state {
      color: #bbb;
      text-align: center;
      font-size: 1.2em;
      margin-top: 2rem;
    }
    .movie-col {
      padding-bottom: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    @media (min-width: 1200px) {
      .movie-col { width: 16.6666%; flex: 0 0 16.6666%; max-width: 16.6666%; }
    }
    @media (min-width: 768px) and (max-width: 1199.98px) {
      .movie-col { width: 25%; flex: 0 0 25%; max-width: 25%; }
    }
    @media (max-width: 767.98px) {
      .movie-col { width: 50%; flex: 0 0 50%; max-width: 50%; }
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 99;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(21, 25, 30, 0.94);
      align-items: center;
      justify-content: center;
      overflow-y: auto;
    }
    #modal-video, #tv-episode-player {
      width: 98%;
      aspect-ratio: 16/9;
      min-height: 180px;
      max-height: 46vh;
      margin: 1rem auto 0;
      display: block;
      border-radius: 6px;
      background: #111;
      border: none;
    }
    @media (max-width: 767.98px) {
      #modal-video, #tv-episode-player {
        min-height: 120px;
        max-height: 30vh;
      }
      .modal-content {
        max-height: 98vh;
      }
    }
    @media (orientation: landscape) and (max-width: 991.98px) {
      #modal-video:fullscreen, #tv-episode-player:fullscreen {
        width: 100vw;
        height: 100vh;
        max-height: none;
        margin: 0;
        border-radius: 0;
      }
    }
    .modal-body {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      padding: 2rem 2rem 1rem;
    }
    .modal-body img {
      max-width: 180px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .modal-genre, .modal-cast, .modal-crew {
      font-size: 0.97em;
      margin-bottom: 6px;
    }
    .modal-trailer {
      margin: 12px 0;
    }
    .server-selector {
      margin: 1.5rem 0 0 2rem;
    }
    .server-selector label {
      color: #eee;
      margin-right: 1em;
    }
    .share-btn {
      display: inline-block;
      margin-top: 12px;
      padding: 7px 18px;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 0.97em;
      cursor: pointer;
      transition: background 0.17s;
    }
    .share-btn:hover, .share-btn:focus {
      background: #2196f3;
      color: #fff;
    }
    #recently-viewed-section {
      margin: 0 0 2.2rem;
      padding: 0.8rem 0.7rem;
      border-radius: 8px;
      background: #1a1f25;
    }
    #recently-viewed-list {
      display: flex;
      overflow-x: auto;
      gap: 1em;
      padding-bottom: 0.4em;
      scrollbar-width: thin;
    }
    #recently-viewed-list .movie-col {
      width: 110px !important;
      min-width: 110px;
      max-width: 110px;
      flex: 0 0 110px !important;
      padding-bottom: 0;
    }
    #recently-viewed-list .movie-title {
      font-size: 0.9em;
    }
    #tv-modal-seasons-list {
      margin-top: 1em;
      background: #23272e;
      color: #eee;
      border-radius: 8px;
      padding: 0.7em;
      max-height: 220px;
      overflow-y: auto;
    }
    .season-block {
      margin-bottom: 0.9em;
    }
    .season-header {
      font-weight: bold;
      font-size: 1.08em;
      cursor: pointer;
      margin-bottom: 0.4em;
      color: #2196f3;
    }
    .episodes-list {
      margin-left: 1.2em;
      margin-bottom: 0.3em;
      padding-bottom: 0.6em;
    }
    .episode-block {
      display: flex;
      align-items: center;
      margin-bottom: 0.25em;
      font-size: 0.97em;
      gap: 0.8em;
      border-left: 2px solid #1976d2;
      padding-left: 0.7em;
    }
    .episode-block span {
      flex: 1 1 auto;
    }
    .tv-episode-play-btn, .tv-episode-next-btn {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 3px;
      padding: 0.25em 0.8em;
      font-size: 0.92em;
      cursor: pointer;
      margin-left: 0.3em;
      transition: background 0.12s;
    }
    .tv-episode-play-btn:hover, .tv-episode-play-btn:focus,
    .tv-episode-next-btn:hover, .tv-episode-next-btn:focus {
      background: #2196f3;
      color: #fff;
      outline: none;
    }
    #tv-episode-player {
      margin-bottom: 1em;
    }
    .iframe-play-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.8em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
      cursor: pointer;
      opacity: 0.9;
      transition: background 0.2s, transform 0.2s;
    }
    .iframe-play-overlay:hover,
    .iframe-play-overlay:focus {
      background: #2196f3;
      transform: translate(-50%, -50%) scale(1.1);
      outline: none;
    }
    .iframe-container {
      position: relative;
      display: inline-block;
      width: 98%;
      margin: 1rem auto 0;
    }
    .genre-filter-form {
      margin-top: 1rem;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #genre-filter-form select {
      background: #1a1f25;
      border: 1px solid #222;
      color: #eee;
      padding: 0.5rem;
      border-radius: 4px;
      width: 100%;
    }
    #genre-filter-form select#year-filter {
      background: #1a1f25;
      border: 1px solid #222;
      color: #eee;
      padding: 0.5rem;
      border-radius: 4px;
      width: 120px;
    }
    #genre-filter-form select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #genre-filter:focus, #year-filter:focus {
      outline: 2px solid #2196f3;
      outline-offset: 2px;
    }
    #clear-genre-btn {
      padding: 0.5rem 1rem;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.17s;
    }
    #clear-genre-btn:hover, #clear-genre-btn:focus {
      background: #2196f3;
      outline: none;
    }
    #back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      cursor: pointer;
      transition: opacity 0.3s, visibility 0.3s, background 0.2s, transform 0.2s;
    }
    #back-to-top:hover, #back-to-top:focus {
      background: #2196f3;
      transform: scale(1.1);
    }
    #back-to-top.visible {
      opacity: 0.9;
      visibility: visible;
    }
    .bmc-button {
      height: 40px !important;
      width: 145px !important;
      transition: transform 0.2s, opacity 0.2s;
      display: inline-block;
      filter: brightness(1);
    }
    .bmc-button:hover,
    .bmc-button:focus {
      filter: brightness(1.1);
      transform: scale(1.05);
    }
    @media (max-width: 767.98px) {
      .bmc-button {
        height: 36px !important;
        width: 130px !important;
      }
    }
    #bmc-hover-btn {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: transparent;
      border: none;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      cursor: pointer;
      transition: opacity 0.3s, visibility 0.3s, transform 0.2s;
    }
    #bmc-hover-btn.visible {
      opacity: 0.9;
      visibility: visible;
    }
    #bmc-hover-btn:hover, #bmc-hover-btn:focus {
      transform: translateX(-50%) scale(1.05);
    }
    #bmc-hover-btn .bmc-button {
      height: 40px !important;
      width: 145px !important;
    }
    @media (max-width: 767.98px) {
      #bmc-hover-btn .bmc-button {
        height: 36px !important;
        width: 130px !important;
      }
    }
    .movie-poster-img {
      loading: lazy;
    }
    #movie-list {
      min-height: 100vh;
    }
    @media (min-width: 768px) and (max-width: 1199.98px) {
      #movie-list {
        min-height: 150vh;
      }
    }
    #movie-search-form.loading::after {
      content: '';
      display: inline-block;
      border: 2px solid #1976d2;
      border-top: 2px solid transparent;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }
  </style>
  <script type="text/javascript" data-cfasync="false">
/*<![CDATA[/* */
(function(){var l=window,b="de9c0ec5a7039cf40d6dc0a042c7e442",i=[["siteId",434*901*786*587-180410845774],["minBid",0],["popundersPerIP","1,1"],["delayBetween",20],["default",false],["defaultPerDay",0],["topmostLayer","auto"]],q=["d3d3LmFudGlhZGJsb2Nrc3lzdGVtcy5jb20vd2JhdG1hbi5taW4uY3Nz","ZDNjb2Q4MHRobjdxbmQuY2xvdWRmcm9udC5uZXQvVXJ3L3Zqc3R6Lm1pbi5qcw=="],z=-1,o,y,g=function(){clearTimeout(y);z++;if(q[z]&&!(1779141316000<(new Date).getTime()&&1<z)){o=l.document.createElement("script");o.type="text/javascript";o.async=!0;var n=l.document.getElementsByTagName("script")[0];o.src="https://"+atob(q[z]);o.crossOrigin="anonymous";o.onerror=g;o.onload=function(){clearTimeout(y);l[b.slice(0,16)+b.slice(0,16)]||g()};y=setTimeout(g,5E3);n.parentNode.insertBefore(o,n)}};if(!l[b]){try{Object.freeze(l[b]=i)}catch(e){}g()}})();
/*]]>/* */
</script>
</head>
<body>
  <div class="modal" id="modal">
    <div class="modal-content" id="modal-content-movie">
      <span class="close" onclick="closeModal()">×</span>
      <div class="modal-body">
        <img id="modal-image" src="" alt="Poster">
        <div class="modal-text">
          <h2 id="modal-title"></h2>
          <div class="stars" id="modal-rating"></div>
          <div class="modal-genre" id="modal-genres"></div>
          <p id="modal-description"></p>
          <div class="modal-cast" id="modal-cast"></div>
          <div class="modal-crew" id="modal-crew"></div>
          <div class="modal-trailer" id="modal-trailer"></div>
          <button class="share-btn" id="share-movie-btn" onclick="shareMovie()">Share</button>
        </div>
      </div>
      <div class="server-selector">
        <label for="server">Change Server:</label>
        <select id="server" onchange="changeServer()">
          <option value="player.videasy.net" selected>Player.Videasy.net</option>
          <option value="vidsrc.cc">Vidsrc.cc</option>
          <option value="vidsrc.me">Vidsrc.me</option>
        </select>
      </div>
      <div class="iframe-container">
        <iframe id="modal-video" allowfullscreen autoplay></iframe>
        <button class="iframe-play-overlay" onclick="triggerIframePlay('modal-video')">
          <i class="fas fa-play"></i>
        </button>
      </div>
      <div id="similar-movies" style="padding: 1rem 2rem;"></div>
    </div>
    <div class="modal-content" id="modal-content-tv" style="display: none;">
      <span class="close" onclick="closeModal()">×</span>
      <div class="modal-body">
        <img id="tv-modal-image" src="" alt="Poster">
        <div class="modal-text">
          <h2 id="tv-modal-title"></h2>
          <div class="modal-genre" id="tv-modal-genres"></div>
          <p id="tv-modal-description"></p>
          <div><strong>First Air Date:</strong> <span id="tv-modal-air-date"></span></div>
          <div><strong>Seasons:</strong> <span id="tv-modal-total-seasons"></span></div>
          <button class="share-btn" id="share-tv-btn" onclick="shareTvShow()" style="margin-bottom: 1em;">Share</button>
          <button class="favorite-btn" id="tv-favorite-btn" title="Add to favorites" aria-label="Add to favorites" tabindex="0">
            <i class="fas fa-heart"></i>
          </button>
          <div id="tv-modal-seasons-list"></div>
        </div>
      </div>
      <div class="iframe-container">
        <iframe id="tv-episode-player" allowfullscreen autoplay style="display: none;"></iframe>
        <button class="iframe-play-overlay" onclick="triggerIframePlay('tv-episode-player')">
          <i class="fas fa-play"></i>
        </button>
      </div>
      <div style="display: flex; justify-content: center;">
        <button class="tv-episode-next-btn" id="tv-episode-next-btn" style="display: none; margin-bottom: 1em;">Next Episode »</button>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <span class="logo-text">MovieDck</span>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto mb-2 mb-lg-0" id="movie-nav">
          <li class="nav-item">
            <a class="nav-link nav-link-1 active" id="nav-movies" href="#" aria-label="Trending Movies">Trending Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="nav-tvshows" href="#" aria-label="Trending TV Shows">Trending TV Shows</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-2" id="nav-anime" href="#" aria-label="Trending Anime Movies">Trending Anime Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-3" id="nav-tagalog" href="#" aria-label="Trending Tagalog Movies">Trending Tagalog Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="nav-netflix" href="#" aria-label="Trending Netflix"><i class="fab fa-netflix"></i> Trending Netflix</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="nav-favorites" href="#" title="Favorites" aria-label="Favorites"><i class="fas fa-heart"></i> Favorites</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="tm-hero d-flex justify-content-center align-items-center" data-parallax="scroll" data-image-src="">
    <form class="d-flex tm-search-form" id="movie-search-form" autocomplete="off" style="width: 100%; max-width: 600px; margin: 2em auto;">
      <input class="form-control tm-search-input" type="search" id="movie-search-input" placeholder="Search for movies, TV shows, or actors..." aria-label="Search">
      <button class="btn btn-outline-success tm-search-btn" type="submit">
        <i class="fas fa-search"></i>
      </button>
    </form>
  </div>

  <div class="container-fluid tm-container-content tm-mt-60">
    <div id="recently-viewed-section" style="display: none;">
      <h5 style="color: #fff; margin-bottom: 0.7em;">Recently Viewed</h5>
      <div id="recently-viewed-list"></div>
    </div>
    <div class="row mb-4">
      <h2 class="col-6 tm-text-primary" id="section-title">Trending Movies</h2>
      <div class="col-6 d-flex justify-content-end align-items-center"></div>
    </div>
    <div class="row mb-4">
      <form class="genre-filter-form" id="genre-filter-form">
        <select id="genre-filter" aria-label="Filter movies by genre" role="listbox" disabled>
          <option value="" id="genre-all">Loading genres...</option>
        </select>
        <select id="year-filter" aria-label="Filter movies by year" role="listbox">
          <option value="" id="year-all">All Years</option>
        </select>
        <button type="button" id="clear-genre-btn" class="btn btn-outline-primary" style="padding: 0.5rem 1rem;">Clear</button>
      </form>
    </div>
    <div class="row tm-mb-90 flex-wrap" id="movie-list" style="margin-left: 0; margin-right: 0;"></div>
    <div id="infinite-loader" style="display: none;"><div class="spinner"></div><p class="loading-state">Loading more...</p></div>
  </div>

  <button id="back-to-top" title="Back to Top" aria-label="Back to Top">
    <i class="fas fa-arrow-up"></i>
  </button>
  <button id="bmc-hover-btn" title="Support us on Buy Me a Coffee" aria-label="Support us on Buy Me a Coffee">
    <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me a Coffee" class="bmc-button">
  </button>

  <footer class="tm-bg-gray pt-5 pb-3 tm-text-gray tm-footer">
    <div class="container-fluid tm-container-small">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-12 px-5 mb-5">
          <h3 class="tm-text-primary mb-4 tm-footer-title">About MovieDck</h3>
          <p>MovieDck is a free, open movie & TV show browser using TMDB, supporting favorites and more. Built for education and fun.</p>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
          <h3 class="tm-text-primary mb-4 tm-footer-title">Quick Links</h3>
          <ul class="tm-footer-links pl-0">
            <li><a href="mailto:norwilaxie@gmail.com">Contact</a></li>
            <li>
              <a href="https://www.buymeacoffee.com/MovieDckWFPH" target="_blank" rel="noopener" aria-label="Support us on Buy Me a Coffee">
                <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me a Coffee" class="bmc-button">
              </a>
            </li>
          </ul>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-8 col-md-7 col-12 px-5 mb-3">Copyright 2025 MovieDck Project.</div>
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script>
  <script>
    // --- CONFIG ---
    const apiKey = '40f1982842db35042e8561b13b38d492';
    const imageBaseUrl = 'https://image.tmdb.org/t/p/w500';
    const maxPages = 100;
    const maxItems = 500;
    let lastModalMovie = null;
    let currentPage = 1;
    let totalPages = 1;
    let currentMode = "popular";
    let currentQuery = "";
    let currentGenre = "";
    let currentYear = "";
    let favorites = JSON.parse(localStorage.getItem('favorites') || "[]");
    let netflixType = "movie";
    let tvModalData = { tvId: null, season: null, episode: null, seasons: [] };
    let categoryItems = [];
    let isLoading = false;
    let reachedEnd = false;
    let loadedPages = new Set();
    let movieGenres = [];
    let tvGenres = [];
    const animeGenres = [
      { id: 16, name: "Anime" },
      { id: 10765, name: "Sci-Fi & Fantasy" },
      { id: 28, name: "Action" },
      { id: 12, name: "Adventure" },
      { id: 35, name: ITS

System: * I'm sorry, it looks like your message was cut off. Based on our previous conversation, you requested the full HTML code to replace your existing file due to issues with the search functionality not displaying results for movie titles, actors, or actresses. I’ll provide the complete HTML with the fixed search functionality, continuing from where your message was interrupted. The code below includes all necessary corrections, particularly in the `fetchMoviesInf` function, to ensure searches for movies, TV shows, and actors/actresses work correctly, while preserving your original UI and functionality. I’ve also added a loading spinner for the search form to improve user experience.

### Complete Updated HTML
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MovieHouse</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      background: #15191e;
      color: #eee;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    .container-fluid, .tm-container-content {
      background: #15191e !important;
    }
    .navbar, .navbar-nav, .nav-link, .tm-text-primary, .tm-footer, .modal-content, .modal, .tm-search-form, .movie-metadata, .modal-body, .modal-text, .footer, .pagination, .page-link, .chip {
      background: #15191e !important;
      color: #eee !important;
      border-color: #222 !important;
    }
    .tm-hero {
      background: #1a1f25;
    }
    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 0.6em 0;
    }
    .navbar-brand .logo-text {
      font-family: 'DM Serif Display', 'Montserrat', Arial, sans-serif;
      font-size: 2.7rem;
      font-weight: 900;
      letter-spacing: 2px;
      color: #fff;
      text-shadow: 0 2px 18px #1976d2c0, 0 1px 2px #1a2028;
      line-height: 1.1;
    }
    @media (max-width: 991.98px) {
      .navbar-brand .logo-text {
        font-size: 1.8rem;
      }
      .navbar-collapse {
        background: #15191e;
        padding: 1rem;
      }
      .navbar-nav {
        flex-direction: column;
        align-items: flex-start;
      }
      .nav-link {
        padding: 0.5rem 1rem;
        font-size: 1.1rem;
      }
      .navbar-toggler {
        border: none;
        color: #eee;
      }
      .navbar-toggler-icon {
        background-image: none;
      }
      .navbar-toggler i {
        font-size: 1.5rem;
        color: #eee;
      }
    }
    .movie-poster-wrapper, .movie-col {
      background: transparent !important;
      position: relative;
    }
    .movie-poster-img {
      background: #222;
      border: 1px solid #222;
      transition: box-shadow 0.2s;
      border-radius: 6px;
      display: block;
      width: 100%;
    }
    .movie-poster-wrapper:focus-within .movie-poster-img,
    .movie-poster-wrapper:hover .movie-poster-img:not(:hover) {
      box-shadow: 0 8px 32px #1976d2aa, 0 2px 10px #15191e80;
      z-index: 2;
    }
    .movie-poster-img:hover {
      box-shadow: 0 8px 32px #1976d2aa, 0 2px 10px #15191e80;
      z-index: 2;
    }
    .movie-poster-wrapper:hover .play-btn-centered,
    .movie-poster-wrapper:focus-within .play-btn-centered {
      filter: brightness(1.13);
    }
    .movie-poster-wrapper {
      cursor: pointer;
      transition: transform 0.15s;
    }
    .movie-poster-wrapper:hover,
    .movie-poster-wrapper:focus-within {
      transform: translateY(-2px) scale(1.02);
      z-index: 1;
    }
    .play-btn-centered {
      position: absolute;
      left: 50%;
      top: 54%;
      transform: translate(-50%, -50%);
      background: #1976d2 !important;
      color: #fff !important;
      border: none;
      border-radius: 50%;
      width: 46px;
      height: 46px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3;
      opacity: 0.95;
      box-shadow: 0 2px 12px #1976d299;
      transition: background 0.2s, box-shadow 0.2s, transform 0.13s;
    }
    .play-btn-centered:hover, .play-btn-centered:focus {
      background: #2196f3 !important;
      box-shadow: 0 4px 18px #1976d2cc, 0 1px 4px #222;
      transform: translate(-50%, -50%) scale(1.08);
      color: #fff !important;
      outline: none;
    }
    .favorite-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 1.4em;
      color: #fff !important;
      z-index: 4;
      cursor: pointer;
      transition: color 0.15s, text-shadow 0.13s;
      outline: none;
    }
    .favorite-btn.favorited {
      color: #ff3870 !important;
      text-shadow: 0 0 8px #fff, 0 1px 6px #d23f7a;
    }
    .favorite-btn:hover, .favorite-btn:focus {
      color: #ff3870 !important;
    }
    #modal-content-tv .favorite-btn {
      background: transparent;
      border: none;
      font-size: 1.4em;
      color: #fff !important;
      cursor: pointer;
      transition: color 0.15s, text-shadow 0.13s;
      outline: none;
      margin: 0.5em 0;
      display: inline-block;
    }
    #modal-content-tv .favorite-btn.favorited {
      color: #ff3870 !important;
      text-shadow: 0 0 8px #fff, 0 1px 6px #d23f7a;
    }
    #modal-content-tv .favorite-btn:hover,
    #modal-content-tv .favorite-btn:focus {
      color: #ff3870 !important;
    }
    .modal-content {
      background: #23272e !important;
      color: #eee !important;
      max-height: 95vh;
      overflow-y: auto;
      border-radius: 8px;
      max-width: 800px;
      width: 98vw;
      margin: 2vw;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .chip {
      background: #1976d2 !important;
      color: #fff !important;
    }
    .close {
      color: #2196f3 !important;
      position: absolute;
      right: 20px;
      top: 18px;
      font-size: 2em;
      cursor: pointer;
      z-index: 2;
      opacity: 0.7;
    }
    .spinner {
      border-top: 7px solid #1976d2;
      border: 7px solid #222;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1.1s linear infinite;
      margin: 40px auto;
      display: block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .empty-state, .error-state, .loading-state {
      color: #bbb;
      text-align: center;
      font-size: 1.2em;
      margin-top: 2rem;
    }
    .movie-col {
      padding-bottom: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    @media (min-width: 1200px) {
      .movie-col { width: 16.6666%; flex: 0 0 16.6666%; max-width: 16.6666%; }
    }
    @media (min-width: 768px) and (max-width: 1199.98px) {
      .movie-col { width: 25%; flex: 0 0 25%; max-width: 25%; }
    }
    @media (max-width: 767.98px) {
      .movie-col { width: 50%; flex: 0 0 50%; max-width: 50%; }
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 99;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(21, 25, 30, 0.94);
      align-items: center;
      justify-content: center;
      overflow-y: auto;
    }
    #modal-video, #tv-episode-player {
      width: 98%;
      aspect-ratio: 16/9;
      min-height: 180px;
      max-height: 46vh;
      margin: 1rem auto 0;
      display: block;
      border-radius: 6px;
      background: #111;
      border: none;
    }
    @media (max-width: 767.98px) {
      #modal-video, #tv-episode-player {
        min-height: 120px;
        max-height: 30vh;
      }
      .modal-content {
        max-height: 98vh;
      }
    }
    @media (orientation: landscape) and (max-width: 991.98px) {
      #modal-video:fullscreen, #tv-episode-player:fullscreen {
        width: 100vw;
        height: 100vh;
        max-height: none;
        margin: 0;
        border-radius: 0;
      }
    }
    .modal-body {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      padding: 2rem 2rem 1rem;
    }
    .modal-body img {
      max-width: 180px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .modal-genre, .modal-cast, .modal-crew {
      font-size: 0.97em;
      margin-bottom: 6px;
    }
    .modal-trailer {
      margin: 12px 0;
    }
    .server-selector {
      margin: 1.5rem 0 0 2rem;
    }
    .server-selector label {
      color: #eee;
      margin-right: 1em;
    }
    .share-btn {
      display: inline-block;
      margin-top: 12px;
      padding: 7px 18px;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 0.97em;
      cursor: pointer;
      transition: background 0.17s;
    }
    .share-btn:hover, .share-btn:focus {
      background: #2196f3;
      color: #fff;
    }
    #recently-viewed-section {
      margin: 0 0 2.2rem;
      padding: 0.8rem 0.7rem;
      border-radius: 8px;
      background: #1a1f25;
    }
    #recently-viewed-list {
      display: flex;
      overflow-x: auto;
      gap: 1em;
      padding-bottom: 0.4em;
      scrollbar-width: thin;
    }
    #recently-viewed-list .movie-col {
      width: 110px !important;
      min-width: 110px;
      max-width: 110px;
      flex: 0 0 110px !important;
      padding-bottom: 0;
    }
    #recently-viewed-list .movie-title {
      font-size: 0.9em;
    }
    #tv-modal-seasons-list {
      margin-top: 1em;
      background: #23272e;
      color: #eee;
      border-radius: 8px;
      padding: 0.7em;
      max-height: 220px;
      overflow-y: auto;
    }
    .season-block {
      margin-bottom: 0.9em;
    }
    .season-header {
      font-weight: bold;
      font-size: 1.08em;
      cursor: pointer;
      margin-bottom: 0.4em;
      color: #2196f3;
    }
    .episodes-list {
      margin-left: 1.2em;
      margin-bottom: 0.3em;
      padding-bottom: 0.6em;
    }
    .episode-block {
      display: flex;
      align-items: center;
      margin-bottom: 0.25em;
      font-size: 0.97em;
      gap: 0.8em;
      border-left: 2px solid #1976d2;
      padding-left: 0.7em;
    }
    .episode-block span {
      flex: 1 1 auto;
    }
    .tv-episode-play-btn, .tv-episode-next-btn {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 3px;
      padding: 0.25em 0.8em;
      font-size: 0.92em;
      cursor: pointer;
      margin-left: 0.3em;
      transition: background 0.12s;
    }
    .tv-episode-play-btn:hover, .tv-episode-play-btn:focus,
    .tv-episode-next-btn:hover, .tv-episode-next-btn:focus {
      background: #2196f3;
      color: #fff;
      outline: none;
    }
    #tv-episode-player {
      margin-bottom: 1em;
    }
    .iframe-play-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.8em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
      cursor: pointer;
      opacity: 0.9;
      transition: background 0.2s, transform 0.2s;
    }
    .iframe-play-overlay:hover,
    .iframe-play-overlay:focus {
      background: #2196f3;
      transform: translate(-50%, -50%) scale(1.1);
      outline: none;
    }
    .iframe-container {
      position: relative;
      display: inline-block;
      width: 98%;
      margin: 1rem auto 0;
    }
    .genre-filter-form {
      margin-top: 1rem;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #genre-filter-form select {
      background: #1a1f25;
      border: 1px solid #222;
      color: #eee;
      padding: 0.5rem;
      border-radius: 4px;
      width: 100%;
    }
    #genre-filter-form select#year-filter {
      background: #1a1f25;
      border: 1px solid #222;
      color: #eee;
      padding: 0.5rem;
      border-radius: 4px;
      width: 120px;
    }
    #genre-filter-form select:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    #genre-filter:focus, #year-filter:focus {
      outline: 2px solid #2196f3;
      outline-offset: 2px;
    }
    #clear-genre-btn {
      padding: 0.5rem 1rem;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.17s;
    }
    #clear-genre-btn:hover, #clear-genre-btn:focus {
      background: #2196f3;
      outline: none;
    }
    #back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      cursor: pointer;
      transition: opacity 0.3s, visibility 0.3s, background 0.2s, transform 0.2s;
    }
    #back-to-top:hover, #back-to-top:focus {
      background: #2196f3;
      transform: scale(1.1);
    }
    #back-to-top.visible {
      opacity: 0.9;
      visibility: visible;
    }
    .bmc-button {
      height: 40px !important;
      width: 145px !important;
      transition: transform 0.2s, opacity 0.2s;
      display: inline-block;
      filter: brightness(1);
    }
    .bmc-button:hover,
    .bmc-button:focus {
      filter: brightness(1.1);
      transform: scale(1.05);
    }
    @media (max-width: 767.98px) {
      .bmc-button {
        height: 36px !important;
        width: 130px !important;
      }
    }
    #bmc-hover-btn {
      position: fixed;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: transparent;
      border: none;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      cursor: pointer;
      transition: opacity 0.3s, visibility 0.3s, transform 0.2s;
    }
    #bmc-hover-btn.visible {
      opacity: 0.9;
      visibility: visible;
    }
    #bmc-hover-btn:hover, #bmc-hover-btn:focus {
      transform: translateX(-50%) scale(1.05);
    }
    #bmc-hover-btn .bmc-button {
      height: 40px !important;
      width: 145px !important;
    }
    @media (max-width: 767.98px) {
      #bmc-hover-btn .bmc-button {
        height: 36px !important;
        width: 130px !important;
      }
    }
    .movie-poster-img {
      loading: lazy;
    }
    #movie-list {
      min-height: 100vh;
    }
    @media (min-width: 768px) and (max-width: 1199.98px) {
      #movie-list {
        min-height: 150vh;
      }
    }
    #movie-search-form.loading::after {
      content: '';
      display: inline-block;
      border: 2px solid #1976d2;
      border-top: 2px solid transparent;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }
  </style>
  <script type="text/javascript" data-cfasync="false">
/*<![CDATA[/* */
(function(){var l=window,b="de9c0ec5a7039cf40d6dc0a042c7e442",i=[["siteId",434*901*786*587-180410845774],["minBid",0],["popundersPerIP","1,1"],["delayBetween",20],["default",false],["defaultPerDay",0],["topmostLayer","auto"]],q=["d3d3LmFudGlhZGJsb2Nrc3lzdGVtcy5jb20vd2JhdG1hbi5taW4uY3Nz","ZDNjb2Q4MHRobjdxbmQuY2xvdWRmcm9udC5uZXQvVXJ3L3Zqc3R6Lm1pbi5qcw=="],z=-1,o,y,g=function(){clearTimeout(y);z++;if(q[z]&&!(1779141316000<(new Date).getTime()&&1<z)){o=l.document.createElement("script");o.type="text/javascript";o.async=!0;var n=l.document.getElementsByTagName("script")[0];o.src="https://"+atob(q[z]);o.crossOrigin="anonymous";o.onerror=g;o.onload=function(){clearTimeout(y);l[b.slice(0,16)+b.slice(0,16)]||g()};y=setTimeout(g,5E3);n.parentNode.insertBefore(o,n)}};if(!l[b]){try{Object.freeze(l[b]=i)}catch(e){}g()}})();
/*]]>/* */
</script>
</head>
<body>
  <div class="modal" id="modal">
    <div class="modal-content" id="modal-content-movie">
      <span class="close" onclick="closeModal()">×</span>
      <div class="modal-body">
        <img id="modal-image" src="" alt="Poster">
        <div class="modal-text">
          <h2 id="modal-title"></h2>
          <div class="stars" id="modal-rating"></div>
          <div class="modal-genre" id="modal-genres"></div>
          <p id="modal-description"></p>
          <div class="modal-cast" id="modal-cast"></div>
          <div class="modal-crew" id="modal-crew"></div>
          <div class="modal-trailer" id="modal-trailer"></div>
          <button class="share-btn" id="share-movie-btn" onclick="shareMovie()">Share</button>
        </div>
      </div>
      <div class="server-selector">
        <label for="server">Change Server:</label>
        <select id="server" onchange="changeServer()">
          <option value="player.videasy.net" selected>Player.Videasy.net</option>
          <option value="vidsrc.cc">Vidsrc.cc</option>
          <option value="vidsrc.me">Vidsrc.me</option>
        </select>
      </div>
      <div class="iframe-container">
        <iframe id="modal-video" allowfullscreen autoplay></iframe>
        <button class="iframe-play-overlay" onclick="triggerIframePlay('modal-video')">
          <i class="fas fa-play"></i>
        </button>
      </div>
      <div id="similar-movies" style="padding: 1rem 2rem;"></div>
    </div>
    <div class="modal-content" id="modal-content-tv" style="display: none;">
      <span class="close" onclick="closeModal()">×</span>
      <div class="modal-body">
        <img id="tv-modal-image" src="" alt="Poster">
        <div class="modal-text">
          <h2 id="tv-modal-title"></h2>
          <div class="modal-genre" id="tv-modal-genres"></div>
          <p id="tv-modal-description"></p>
          <div><strong>First Air Date:</strong> <span id="tv-modal-air-date"></span></div>
          <div><strong>Seasons:</strong> <span id="tv-modal-total-seasons"></span></div>
          <button class="share-btn" id="share-tv-btn" onclick="shareTvShow()" style="margin-bottom: 1em;">Share</button>
          <button class="favorite-btn" id="tv-favorite-btn" title="Add to favorites" aria-label="Add to favorites" tabindex="0">
            <i class="fas fa-heart"></i>
          </button>
          <div id="tv-modal-seasons-list"></div>
        </div>
      </div>
      <div class="iframe-container">
        <iframe id="tv-episode-player" allowfullscreen autoplay style="display: none;"></iframe>
        <button class="iframe-play-overlay" onclick="triggerIframePlay('tv-episode-player')">
          <i class="fas fa-play"></i>
        </button>
      </div>
      <div style="display: flex; justify-content: center;">
        <button class="tv-episode-next-btn" id="tv-episode-next-btn" style="display: none; margin-bottom: 1em;">Next Episode »</button>
      </div>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <span class="logo-text">MovieDck</span>
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto mb-2 mb-lg-0" id="movie-nav">
          <li class="nav-item">
            <a class="nav-link nav-link-1 active" id="nav-movies" href="#" aria-label="Trending Movies">Trending Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="nav-tvshows" href="#" aria-label="Trending TV Shows">Trending TV Shows</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-2" id="nav-anime" href="#" aria-label="Trending Anime Movies">Trending Anime Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-3" id="nav-tagalog" href="#" aria-label="Trending Tagalog Movies">Trending Tagalog Movies</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="nav-netflix" href="#" aria-label="Trending Netflix"><i class="fab fa-netflix"></i> Trending Netflix</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="nav-favorites" href="#" title="Favorites" aria-label="Favorites"><i class="fas fa-heart"></i> Favorites</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="tm-hero d-flex justify-content-center align-items-center" data-parallax="scroll" data-image-src="">
    <form class="d-flex tm-search-form" id="movie-search-form" autocomplete="off" style="width: 100%; max-width: 600px; margin: 2em auto;">
      <input class="form-control tm-search-input" type="search" id="movie-search-input" placeholder="Search for movies, TV shows, or actors..." aria-label="Search">
      <button class="btn btn-outline-success tm-search-btn" type="submit">
        <i class="fas fa-search"></i>
      </button>
    </form>
  </div>

  <div class="container-fluid tm-container-content tm-mt-60">
    <div id="recently-viewed-section" style="display: none;">
      <h5 style="color: #fff; margin-bottom: 0.7em;">Recently Viewed</h5>
      <div id="recently-viewed-list"></div>
    </div>
    <div class="row mb-4">
      <h2 class="col-6 tm-text-primary" id="section-title">Trending Movies</h2>
      <div class="col-6 d-flex justify-content-end align-items-center"></div>
    </div>
    <div class="row mb-4">
      <form class="genre-filter-form" id="genre-filter-form">
        <select id="genre-filter" aria-label="Filter movies by genre" role="listbox" disabled>
          <option value="" id="genre-all">Loading genres...</option>
        </select>
        <select id="year-filter" aria-label="Filter movies by year" role="listbox">
          <option value="" id="year-all">All Years</option>
        </select>
        <button type="button" id="clear-genre-btn" class="btn btn-outline-primary" style="padding: 0.5rem 1rem;">Clear</button>
      </form>
    </div>
    <div class="row tm-mb-90 flex-wrap" id="movie-list" style="margin-left: 0; margin-right: 0;"></div>
    <div id="infinite-loader" style="display: none;"><div class="spinner"></div><p class="loading-state">Loading more...</p></div>
  </div>

  <button id="back-to-top" title="Back to Top" aria-label="Back to Top">
    <i class="fas fa-arrow-up"></i>
  </button>
  <button id="bmc-hover-btn" title="Support us on Buy Me a Coffee" aria-label="Support us on Buy Me a Coffee">
    <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me a Coffee" class="bmc-button">
  </button>

  <footer class="tm-bg-gray pt-5 pb-3 tm-text-gray tm-footer">
    <div class="container-fluid tm-container-small">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-12 px-5 mb-5">
          <h3 class="tm-text-primary mb-4 tm-footer-title">About MovieDck</h3>
          <p>MovieDck is a free, open movie & TV show browser using TMDB, supporting favorites and more. Built for education and fun.</p>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
          <h3 class="tm-text-primary mb-4 tm-footer-title">Quick Links</h3>
          <ul class="tm-footer-links pl-0">
            <li><a href="mailto:norwilaxie@gmail.com">Contact</a></li>
            <li>
              <a href="https://www.buymeacoffee.com/MovieDckWFPH" target="_blank" rel="noopener" aria-label="Support us on Buy Me a Coffee">
                <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me a Coffee" class="bmc-button">
              </a>
            </li>
          </ul>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-8 col-md-7 col-12 px-5 mb-3">Copyright 2025 MovieDck Project.</div>
      </div>
    </div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js"></script>
  <script>
    // --- CONFIG ---
    const apiKey = '40f1982842db35042e8561b13b38d492';
    const imageBaseUrl = 'https://image.tmdb.org/t/p/w500';
    const maxPages = 100;
    const maxItems = 500;
    let lastModalMovie = null;
    let currentPage = 1;
    let totalPages = 1;
    let currentMode = "popular";
    let currentQuery = "";
    let currentGenre = "";
    let currentYear = "";
    let favorites = JSON.parse(localStorage.getItem('favorites') || "[]");
    let netflixType = "movie";
    let tvModalData = { tvId: null, season: null, episode: null, seasons: [] };
    let categoryItems = [];
    let isLoading = false;
    let reachedEnd = false;
    let loadedPages = new Set();
    let movieGenres = [];
    let tvGenres = [];
    const animeGenres = [
      { id: 16, name: "Anime" },
      { id: 10765, name: "Sci-Fi & Fantasy" },
      { id: 28, name: "Action" },
      { id: 12, name: "Adventure" },
      { id: 35, name: "Comedy" },
      { id: 18, name: "Drama" },
      { id: 10749, name: "Romance" },
      { id: 14, name: "Fantasy" }
    ];
    const movieList = document.getElementById('movie-list');
    const infiniteLoader = document.getElementById('infinite-loader');
    const genreFilter = document.getElementById('genre-filter');

    // Throttle function
    function throttle(func, limit) {
      let inThrottle;
      return function (...args) {
        if (!inThrottle) {
          func.apply(this, args);
          inThrottle = true;
          setTimeout(() => (inThrottle = false), limit);
        }
      };
    }

    // Debounce function
    function debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Check if device is mobile or tablet
    function isMobileOrTablet() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
             window.matchMedia("(max-width: 991.98px)").matches;
    }

    // Handle orientation lock for fullscreen
    function handleFullscreenOrientation(iframe) {
      if (!isMobileOrTablet()) return;
      const lockOrientation = () => {
        if (document.fullscreenElement === iframe && screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(err => {
            console.warn('Orientation lock failed:', err);
            showErrorMessage(iframe, 'Please rotate your device to landscape for the best fullscreen experience.');
          });
        }
      };
      const unlockOrientation = () => {
        if (screen.orientation && screen.orientation.unlock) {
          screen.orientation.unlock().catch(err => console.warn('Orientation unlock failed:', err));
        }
      };
      iframe.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement === iframe) {
          lockOrientation();
        } else {
          unlockOrientation();
        }
      });
    }

    // Helper for error messages
    function showErrorMessage(iframe, message) {
      const modalBody = iframe.closest('.modal-content').querySelector('.modal-body');
      const existingError = modalBody.querySelector('.error-state');
      if (existingError) existingError.remove();
      const errorMsg = document.createElement('p');
      errorMsg.className = 'error-state';
      errorMsg.textContent = message;
      errorMsg.style.marginTop = '1rem';
      modalBody.appendChild(errorMsg);
      setTimeout(() => errorMsg.remove(), 5000);
    }

    // Fetch genres
    async function fetchGenres() {
      try {
        const [movieRes, tvRes] = await Promise.all([
          fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${apiKey}`),
          fetch(`https://api.themoviedb.org/3/genre/tv/list?api_key=${apiKey}`)
        ]);
        if (!movieRes.ok || !tvRes.ok) throw new Error('Failed to fetch genres');
        const movieData = await movieRes.json();
        const tvData = await tvRes.json();
        movieGenres = movieData.genres || [];
        tvGenres = tvData.genres || [];
        populateGenreFilter();
        genreFilter.disabled = false;
      } catch (e) {
        console.error('Error fetching genres:', e);
        genreFilter.innerHTML = '<option value="" id="genre-all">Failed to load genres</option>';
        genreFilter.disabled = false;
      }
    }

    // Populate genre filter dropdown
    function populateGenreFilter() {
      genreFilter.innerHTML = '<option value="" id="genre-all">All Genres</option>';
      let genres = [];
      if (currentMode === "tv") {
        genres = tvGenres;
      } else if (currentMode === "anime") {
        genres = animeGenres;
      } else if (currentMode === "netflix") {
        genres = netflixType === "movie" ? movieGenres : tvGenres;
      } else if (currentMode === "favorites") {
        genres = [...new Set([...movieGenres, ...tvGenres])].sort((a, b) => a.name.localeCompare(b.name));} else {
        genres = movieGenres;
      }
      genres.forEach(genre => {
        const option = document.createElement('option');
        option.value = genre.id;
        option.textContent = genre.name;
        genreFilter.appendChild(option);
      });
      if (currentGenre) {
        genreFilter.value = currentGenre;
      }
    }

    // Populate year filter dropdown
    function populateYearFilter() {
      const yearFilter = document.getElementById('year-filter');
      yearFilter.innerHTML = '<option value="" id="year-all">All Years</option>';
      const currentYear = new Date().getFullYear();
      for (let year = currentYear; year >= 1900; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearFilter.appendChild(option);
      }
      if (currentYear) {
        yearFilter.value = currentYear;
      }
    }

    // Check if item is in favorites
    function isFavorite(id, mediaType) {
      return favorites.some(fav => fav.id === id && fav.media_type === mediaType);
    }

    // Toggle favorite status
    function toggleFavorite(id, mediaType) {
      const index = favorites.findIndex(fav => fav.id === id && fav.media_type === mediaType);
      if (index === -1) {
        favorites.push({ id, media_type: mediaType });
      } else {
        favorites.splice(index, 1);
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      if (currentMode === 'favorites') {
        switchMode('favorites');
      }
      updateFavoriteButtons();
    }

    // Update favorite buttons UI
    function updateFavoriteButtons() {
      document.querySelectorAll('.favorite-btn').forEach(btn => {
        const movieCol = btn.closest('.movie-col');
        const modalContent = btn.closest('.modal-content');
        let id, mediaType;
        if (movieCol) {
          id = Number(movieCol.querySelector('.play-btn-centered').getAttribute('title').match(/ID: (\d+)/)?.[1]);
          mediaType = movieCol.querySelector('.movie-type')?.textContent === 'TV Show' ? 'tv' : 'movie';
        } else if (modalContent) {
          id = modalContent.id === 'modal-content-tv' ? tvModalData.tvId : lastModalMovie?.id;
          mediaType = modalContent.id === 'modal-content-tv' ? 'tv' : 'movie';
        }
        if (id && mediaType) {
          btn.classList.toggle('favorited', isFavorite(id, mediaType));
        }
      });
    }

    // Fetch movies or TV shows
    async function fetchMoviesInf(page = 1) {
      console.log(`[fetchMoviesInf] Fetching page ${page}, mode: ${currentMode}, query: ${currentQuery}, genre: ${currentGenre}, year: ${currentYear}`);
      if (loadedPages.has(page) || page > maxPages) {
        console.log(`[fetchMoviesInf] Page ${page} already loaded or exceeds maxPages`);
        return [];
      }
      const isTablet = window.matchMedia("(min-width: 768px) and (max-width: 1199.98px)").matches;
      const perPage = isTablet ? 40 : 20;
      try {
        genreFilter.disabled = true;
        document.getElementById('year-filter').disabled = true;
        let results = [];
        let url = "";
        
        if (currentMode === "search" && currentQuery.trim()) {
          const multiRes = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${encodeURIComponent(currentQuery)}&page=${page}&include_adult=false`);
          if (!multiRes.ok) throw new Error(`Multi-search failed: ${multiRes.status}`);
          const multiData = await multiRes.json();
          results = (multiData.results || []).filter(item => item.media_type === 'movie' || item.media_type === 'tv');
          totalPages = Math.min(multiData.total_pages || 1, maxPages);

          const personRes = await fetch(`https://api.themoviedb.org/3/search/person?api_key=${apiKey}&query=${encodeURIComponent(currentQuery)}&page=1&include_adult=false`);
          if (!personRes.ok) throw new Error(`Person search failed: ${personRes.status}`);
          const personData = await personRes.json();

          if (personData.results && personData.results.length > 0) {
            const person = personData.results[0];
            const movieCreditsRes = await fetch(`https://api.themoviedb.org/3/person/${person.id}/movie_credits?api_key=${apiKey}`);
            if (!movieCreditsRes.ok) throw new Error(`Movie credits failed: ${movieCreditsRes.status}`);
            const creditsData = await movieCreditsRes.json();
            const castMovies = (creditsData.cast || []).map(movie => ({
              ...movie,
              media_type: 'movie'
            }));
            const uniqueIds = new Set(results.map(item => item.id));
            results = [...results, ...castMovies.filter(movie => !uniqueIds.has(movie.id))].slice(0, perPage);
          }

          if (!results.length) {
            movieList.innerHTML = `<div class="empty-state">No results found for "${currentQuery}"${currentGenre ? ` in genre ${currentGenre}` : ''}${currentYear ? ` from ${currentYear}` : ''}.</div>`;
            return [];
          }
        } else if (currentMode === "anime") {
          url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_genres=${currentGenre || 16}&with_original_language=ja${currentYear ? `&primary_release_year=${currentYear}` : ''}&sort_by=popularity.desc&page=${page}`;
        } else if (currentMode === "tagalog") {
          url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}&with_original_language=tl${currentGenre ? `&with_genres=${currentGenre}` : ''}${currentYear ? `&primary_release_year=${currentYear}` : ''}&sort_by=popularity.desc&page=${page}`;
        } else if (currentMode === "tv") {
          url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}${currentGenre ? `&with_genres=${currentGenre}` : ''}${currentYear ? `&first_air_date_year=${currentYear}` : ''}&sort_by=popularity.desc&page=${page}`;
        } else if (currentMode === "netflix") {
          url = `https://api.themoviedb.org/3/discover/${netflixType}?api_key=${apiKey}&with_watch_providers=8&watch_region=US${currentGenre ? `&with_genres=${currentGenre}` : ''}${currentYear ? `&${netflixType === 'movie' ? 'primary_release_year' : 'first_air_date_year'}=${currentYear}` : ''}&sort_by=popularity.desc&page=${page}`;
        } else {
          url = `https://api.themoviedb.org/3/discover/movie?api_key=${apiKey}${currentGenre ? `&with_genres=${currentGenre}` : ''}${currentYear ? `&primary_release_year=${currentYear}` : ''}&sort_by=popularity.desc&page=${page}`;
        }

        if (url) {
          const response = await fetch(url);
          if (!response.ok) throw new Error(`Discover failed: ${response.status}`);
          const data = await response.json();
          results = (data.results || []).slice(0, perPage);
          totalPages = Math.min(data.total_pages || 1, maxPages);
        }

        if (!results.length) {
          movieList.innerHTML = `<div class="empty-state">No items found for "${currentQuery || 'this category'}"${currentGenre ? ` in genre ${currentGenre}` : ''}${currentYear ? ` from ${currentYear}` : ''}.</div>`;
          return [];
        }

        loadedPages.add(page);
        console.log(`[fetchMoviesInf] Fetched ${results.length} items for page ${page}`);
        return results;
      } catch (e) {
        console.error('[fetchMoviesInf] Error:', e.message);
        movieList.innerHTML = `<div class="error-state">Failed to load content: ${e.message}. Please check your connection or try again later.</div>`;
        infiniteLoader.style.display = "none";
        return [];
      } finally {
        genreFilter.disabled = false;
        document.getElementById('year-filter').disabled = false;
      }
    }

    // Render movies or TV shows
    function renderMovies(items, clear = false) {
      console.log(`[renderMovies] Rendering ${items.length} items, clear=${clear}`);
      if (clear) movieList.innerHTML = '';
      if (!items || items.length === 0) {
        if (clear) movieList.innerHTML = `<div class="empty-state">No items found for "${currentQuery || 'this category'}"${currentGenre ? ` in genre ${currentGenre}` : ''}${currentYear ? ` from ${currentYear}` : ''}.</div>`;
        return;
      }
      const fragment = document.createDocumentFragment();
      items.forEach(item => {
        const isTv = item.media_type === 'tv' || !!item.name && !item.title;
        const mediaType = isTv ? 'tv' : 'movie';
        const movieDiv = document.createElement('div');
        movieDiv.className = 'movie-col';
        movieDiv.innerHTML = `
          <div class="movie-poster-wrapper" tabindex="0">
            <img loading="lazy" src="${item.poster_path ? imageBaseUrl + item.poster_path : 'img/no-poster.png'}" alt="${isTv ? item.name : item.title}" class="img-fluid movie-poster-img">
            <button class="play-btn-centered" type="button" title="${isTv ? `View TV Show (ID: ${item.id})` : `Play Movie (ID: ${item.id})`}">
              <i class="fas fa-${isTv ? 'tv' : 'play'}"></i>
            </button>
            <button class="favorite-btn${isFavorite(item.id, mediaType) ? ' favorited' : ''}" title="Add to favorites" aria-label="Add to favorites" tabindex="0">
              <i class="fas fa-heart"></i>
            </button>
          </div>
          <div class="movie-metadata">
            <span class="movie-title" title="${isTv ? item.name : item.title}">${isTv ? item.name : item.title}</span>
            <span class="movie-year">${(isTv ? item.first_air_date : item.release_date) ? (isTv ? item.first_air_date : item.release_date).slice(0, 4) : ""}</span>
            ${isTv ? '<span class="movie-type" style="font-size: 0.9em; color: #1976d2;">TV Show</span>' : ''}
          </div>
        `;
        movieDiv.querySelector('.play-btn-centered').onclick = () => {
          if (isTv) showTvDetails(item);
          else showDetails(item);
        };
        movieDiv.querySelector('.favorite-btn').onclick = (e) => {
          e.stopPropagation();
          toggleFavorite(item.id, mediaType);
        };
        fragment.appendChild(movieDiv);
      });
      movieList.appendChild(fragment);
    }

    // Load more movies
    async function loadMoreMovies() {
      if (isLoading || reachedEnd) return;
      isLoading = true;
      infiniteLoader.style.display = 'block';
      try {
        const items = await fetchMoviesInf(currentPage);
        if (items.length === 0 || currentPage >= totalPages) {
          reachedEnd = true;
          infiniteLoader.style.display = 'none';
          return;
        }
        renderMovies(items);
        currentPage++;
      } catch (e) {
        console.error('[loadMoreMovies] Error:', e);
        movieList.innerHTML = `<div class="error-state">Failed to load more content: ${e.message}</div>`;
      } finally {
        isLoading = false;
        infiniteLoader.style.display = 'none';
      }
    }

    // Reset infinite scroll
    function resetInfiniteScroll() {
      currentPage = 1;
      loadedPages.clear();
      reachedEnd = false;
      totalPages = 1;
      movieList.innerHTML = '';
      infiniteLoader.style.display = 'block';
      loadMoreMovies();
    }

    // Switch mode
    async function switchMode(mode) {
      currentMode = mode;
      document.querySelectorAll('#movie-nav .nav-link').forEach(link => link.classList.remove('active'));
      document.getElementById(`nav-${mode === 'popular' ? 'movies' : mode}`).classList.add('active');
      const titles = {
        popular: 'Trending Movies',
        tv: 'Trending TV Shows',
        anime: 'Trending Anime Movies',
        tagalog: 'Trending Tagalog Movies',
        netflix: `Trending Netflix ${netflixType === 'movie' ? 'Movies' : 'TV Shows'}`,
        favorites: 'Favorites',
        search: `Search Results for "${currentQuery}"`
      };
      document.getElementById('section-title').textContent = titles[mode] || 'Trending Movies';
      if (mode === 'favorites') {
        renderFavorites();
        infiniteLoader.style.display = 'none';
      } else {
        resetInfiniteScroll();
      }
      populateGenreFilter();
    }

    // Render favorites
    function renderFavorites() {
      movieList.innerHTML = '';
      if (!favorites.length) {
        movieList.innerHTML = '<div class="empty-state">No favorites added yet.</div>';
        return;
      }
      const items = favorites.map(fav => ({
        id: fav.id,
        media_type: fav.media_type,
        title: fav.title || fav.name,
        name: fav.name,
        poster_path: fav.poster_path,
        release_date: fav.release_date,
        first_air_date: fav.first_air_date
      }));
      renderMovies(items, true);
    }

    // Show movie details
    async function showDetails(movie) {
      console.log('[showDetails] Movie:', movie);
      lastModalMovie = movie;
      const modal = document.getElementById('modal');
      const modalContentMovie = document.getElementById('modal-content-movie');
      const modalContentTv = document.getElementById('modal-content-tv');
      modalContentMovie.style.display = 'block';
      modalContentTv.style.display = 'none';
      modal.style.display = 'flex';
      document.getElementById('modal-image').src = movie.poster_path ? imageBaseUrl + movie.poster_path : 'img/no-poster.png';
      document.getElementById('modal-title').textContent = movie.title;
      document.getElementById('modal-description').textContent = movie.overview || 'No description available.';
      document.getElementById('modal-rating').innerHTML = getStars(movie.vote_average || 0);
      try {
        const [detailsRes, creditsRes, videosRes, similarRes] = await Promise.all([
          fetch(`https://api.themoviedb.org/3/movie/${movie.id}?api_key=${apiKey}`),
          fetch(`https://api.themoviedb.org/3/movie/${movie.id}/credits?api_key=${apiKey}`),
          fetch(`https://api.themoviedb.org/3/movie/${movie.id}/videos?api_key=${apiKey}`),
          fetch(`https://api.themoviedb.org/3/movie/${movie.id}/similar?api_key=${apiKey}&page=1`)
        ]);
        if (!detailsRes.ok) throw new Error('Failed to fetch movie details');
        const details = await detailsRes.json();
        document.getElementById('modal-genres').innerHTML = `<strong>Genres:</strong> ${details.genres?.map(g => g.name).join(', ') || 'N/A'}`;
        if (creditsRes.ok) {
          const credits = await creditsRes.json();
          document.getElementById('modal-cast').innerHTML = `<strong>Cast:</strong> ${credits.cast?.slice(0, 3).map(c => c.name).join(', ') || 'N/A'}`;
          document.getElementById('modal-crew').innerHTML = `<strong>Director:</strong> ${credits.crew?.find(c => c.job === 'Director')?.name || 'N/A'}`;
        }
        if (videosRes.ok) {
          const videos = await videosRes.json();
          const trailer = videos.results?.find(v => v.type === 'Trailer' && v.site === 'YouTube');
          document.getElementById('modal-trailer').innerHTML = trailer
            ? `<a href="https://www.youtube.com/watch?v=${trailer.key}" target="_blank" rel="noopener">Watch Trailer</a>`
            : '';
        }
        if (similarRes.ok) {
          const similar = await similarRes.json();
          renderSimilarMovies(similar.results?.slice(0, 6) || []);
        }
        const serverSelect = document.getElementById('server');
        changeServer();
        addToRecentlyViewed(movie, 'movie');
      } catch (e) {
        console.error('[showDetails] Error:', e);
        showErrorMessage(document.getElementById('modal-video'), 'Failed to load movie details.');
      }
      updateFavoriteButtons();
    }

    // Show TV show details
    async function showTvDetails(tv) {
      console.log('[showTvDetails] TV:', tv);
      tvModalData.tvId = tv.id;
      const modal = document.getElementById('modal');
      const modalContentMovie = document.getElementById('modal-content-movie');
      const modalContentTv = document.getElementById('modal-content-tv');
      modalContentMovie.style.display = 'none';
      modalContentTv.style.display = 'block';
      modal.style.display = 'flex';
      document.getElementById('tv-modal-image').src = tv.poster_path ? imageBaseUrl + tv.poster_path : 'img/no-poster.png';
      document.getElementById('tv-modal-title').textContent = tv.name;
      document.getElementById('tv-modal-description').textContent = tv.overview || 'No description available.';
      document.getElementById('tv-modal-air-date').textContent = tv.first_air_date || 'N/A';
      try {
        const detailsRes = await fetch(`https://api.themoviedb.org/3/tv/${tv.id}?api_key=${apiKey}`);
        if (!detailsRes.ok) throw new Error('Failed to fetch TV details');
        const details = await detailsRes.json();
        document.getElementById('tv-modal-genres').innerHTML = `<strong>Genres:</strong> ${details.genres?.map(g => g.name).join(', ') || 'N/A'}`;
        document.getElementById('tv-modal-total-seasons').textContent = details.number_of_seasons || 'N/A';
        tvModalData.seasons = details.seasons?.filter(s => s.season_number > 0) || [];
        renderSeasonsList();
        addToRecentlyViewed(tv, 'tv');
      } catch (e) {
        console.error('[showTvDetails] Error:', e);
        showErrorMessage(document.getElementById('tv-episode-player'), 'Failed to load TV details.');
      }
      updateFavoriteButtons();
    }

    // Render seasons list
    function renderSeasonsList() {
      const seasonsList = document.getElementById('tv-modal-seasons-list');
      seasonsList.innerHTML = '';
      tvModalData.seasons.forEach(season => {
        const seasonBlock = document.createElement('div');
        seasonBlock.className = 'season-block';
        seasonBlock.innerHTML = `<div class="season-header">Season ${season.season_number}</div>`;
        const episodesList = document.createElement('div');
        episodesList.className = 'episodes-list';
        episodesList.style.display = 'none';
        seasonBlock.appendChild(episodesList);
        seasonBlock.querySelector('.season-header').onclick = () => toggleEpisodes(episodesList, season.season_number);
        seasonsList.appendChild(seasonBlock);
      });
    }

    // Toggle episodes list
    async function toggleEpisodes(episodesList, seasonNumber) {
      if (episodesList.style.display === 'none') {
        episodesList.style.display = 'block';
        if (!episodesList.innerHTML) {
          try {
            const res = await fetch(`https://api.themoviedb.org/3/tv/${tvModalData.tvId}/season/${seasonNumber}?api_key=${apiKey}`);
            if (!res.ok) throw new Error('Failed to fetch episodes');
            const data = await res.json();
            data.episodes?.forEach(episode => {
              const episodeBlock = document.createElement('div');
              episodeBlock.className = 'episode-block';
              episodeBlock.innerHTML = `
                <span>Episode ${episode.episode_number}: ${episode.name}</span>
                <button class="tv-episode-play-btn" data-season="${seasonNumber}" data-episode="${episode.episode_number}">Play</button>
              `;
              episodeBlock.querySelector('.tv-episode-play-btn').onclick = () => playEpisode(seasonNumber, episode.episode_number);
              episodesList.appendChild(episodeBlock);
            });
          } catch (e) {
            console.error('[toggleEpisodes] Error:', e);
            showErrorMessage(document.getElementById('tv-episode-player'), 'Failed to load episodes.');
          }
        }
      } else {
        episodesList.style.display = 'none';
      }
    }

    // Play episode
    function playEpisode(season, episode) {
      tvModalData.season = season;
      tvModalData.episode = episode;
      const player = document.getElementById('tv-episode-player');
      const server = document.getElementById('server').value;
      player.src = `https://${server}/v2/embed/tv/${tvModalData.tvId}/${season}/${episode}`;
      player.style.display = 'block';
      document.getElementById('tv-episode-next-btn').style.display = 'block';
      document.getElementById('tv-episode-next-btn').onclick = () => playNextEpisode();
      triggerIframePlay('tv-episode-player');
    }

    // Play next episode
    async function playNextEpisode() {
      try {
        const res = await fetch(`https://api.themoviedb.org/3/tv/${tvModalData.tvId}/season/${tvModalData.season}?api_key=${apiKey}`);
        if (!res.ok) throw new Error('Failed to fetch episodes');
        const data = await res.json();
        const nextEpisode = data.episodes?.find(ep => ep.episode_number === tvModalData.episode + 1);
        if (nextEpisode) {
          playEpisode(tvModalData.season, tvModalData.episode + 1);
        } else {
          const nextSeason = tvModalData.seasons.find(s => s.season_number === tvModalData.season + 1);
          if (nextSeason) {
            playEpisode(nextSeason.season_number, 1);
          } else {
            showErrorMessage(document.getElementById('tv-episode-player'), 'No more episodes available.');
          }
        }
      } catch (e) {
        console.error('[playNextEpisode] Error:', e);
        showErrorMessage(document.getElementById('tv-episode-player'), 'Failed to load next episode.');
      }
    }

    // Render similar movies
    function renderSimilarMovies(movies) {
      const similarMovies = document.getElementById('similar-movies');
      similarMovies.innerHTML = '<h5 style="color: #fff; margin-bottom: 0.7em;">Similar Movies</h5>';
      if (!movies.length) {
        similarMovies.innerHTML += '<p class="empty-state">No similar movies found.</p>';
        return;
      }
      const fragment = document.createDocumentFragment();
      movies.forEach(movie => {
        const movieDiv = document.createElement('div');
        movieDiv.className = 'movie-col';
        movieDiv.style.width = '110px';
        movieDiv.style.minWidth = '110px';
        movieDiv.style.maxWidth = '110px';
        movieDiv.style.flex = '0 0 110px';
        movieDiv.innerHTML = `
          <div class="movie-poster-wrapper" tabindex="0">
            <img loading="lazy" src="${movie.poster_path ? imageBaseUrl + movie.poster_path : 'img/no-poster.png'}" alt="${movie.title}" class="img-fluid movie-poster-img">
            <button class="play-btn-centered" type="button" title="Play Movie (ID: ${movie.id})">
              <i class="fas fa-play"></i>
            </button>
            <button class="favorite-btn${isFavorite(movie.id, 'movie') ? ' favorited' : ''}" title="Add to favorites" aria-label="Add to favorites" tabindex="0">
              <i class="fas fa-heart"></i>
            </button>
          </div>
          <div class="movie-metadata">
            <span class="movie-title" title="${movie.title}">${movie.title}</span>
            <span class="movie-year">${movie.release_date ? movie.release_date.slice(0, 4) : ""}</span>
          </div>
        `;
        movieDiv.querySelector('.play-btn-centered').onclick = () => showDetails(movie);
        movieDiv.querySelector('.favorite-btn').onclick = (e) => {
          e.stopPropagation();
          toggleFavorite(movie.id, 'movie');
        };
        fragment.appendChild(movieDiv);
      });
      similarMovies.appendChild(fragment);
    }

    // Add to recently viewed
    function addToRecentlyViewed(item, mediaType) {
      let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
      recentlyViewed = recentlyViewed.filter(viewed => !(viewed.id === item.id && viewed.media_type === mediaType));
      recentlyViewed.unshift({
        id: item.id,
        media_type: mediaType,
        title: item.title || item.name,
        name: item.name,
        poster_path: item.poster_path,
        release_date: item.release_date,
        first_air_date: item.first_air_date
      });
      recentlyViewed = recentlyViewed.slice(0, 10);
      localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
      renderRecentlyViewed();
    }

    // Render recently viewed
    function renderRecentlyViewed() {
      const recentlyViewedSection = document.getElementById('recently-viewed-section');
      const recentlyViewedList = document.getElementById('recently-viewed-list');
      const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
      if (!recentlyViewed.length) {
        recentlyViewedSection.style.display = 'none';
        return;
      }
      recentlyViewedSection.style.display = 'block';
      recentlyViewedList.innerHTML = '';
      renderMovies(recentlyViewed);
    }

    // Close modal
    function closeModal() {
      const modal = document.getElementById('modal');
      modal.style.display = 'none';
      document.getElementById('modal-video').src = '';
      document.getElementById('tv-episode-player').src = '';
      document.getElementById('tv-episode-player').style.display = 'none';
      document.getElementById('tv-episode-next-btn').style.display = 'none';
      tvModalData.season = null;
      tvModalData.episode = null;
      updateFavoriteButtons();
    }

    // Change server
    function changeServer() {
      const server = document.getElementById('server').value;
      if (lastModalMovie) {
        const iframe = document.getElementById('modal-video');
        iframe.src = `https://${server}/v2/embed/movie/${lastModalMovie.id}`;
        triggerIframePlay('modal-video');
      }
    }

    // Trigger iframe play
    function triggerIframePlay(iframeId) {
      const iframe = document.getElementById(iframeId);
      const overlay = iframe.nextElementSibling;
      overlay.style.display = 'none';
      iframe.focus();
      handleFullscreenOrientation(iframe);
    }

    // Share movie
    function shareMovie() {
      if (!lastModalMovie) return;
      const text = `Check out "${lastModalMovie.title}" on MovieDck!`;
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: lastModalMovie.title, text, url }).catch(err => console.error('Share failed:', err));
      } else {
        navigator.clipboard.writeText(`${text} ${url}`).then(() => alert('Link copied to clipboard!'));
      }
    }

    // Share TV show
    function shareTvShow() {
      if (!tvModalData.tvId) return;
      const text = `Check out this TV show on MovieDck!`;
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: document.getElementById('tv-modal-title').textContent, text, url }).catch(err => console.error('Share failed:', err));
      } else {
        navigator.clipboard.writeText(`${text} ${url}`).then(() => alert('Link copied to clipboard!'));
      }
    }

    // Get star rating
    function getStars(rating) {
      const stars = Math.round(rating / 2);
      let starHtml = '';
      for (let i = 0; i < 5; i++) {
        starHtml += `<i class="fas fa-star ${i < stars ? 'text-warning' : 'text-muted'}"></i>`;
      }
      return starHtml;
    }

    // DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      fetchGenres();
      populateYearFilter();
      const bmcHoverBtn = document.getElementById('bmc-hover-btn');

      window.addEventListener('scroll', () => {
        if (window.scrollY > 400) {
          document.getElementById('back-to-top').classList.add('visible');
          if (document.getElementById('modal').style.display !== 'flex') {
            bmcHoverBtn.classList.add('visible');
          }
        } else {
          document.getElementById('back-to-top').classList.remove('visible');
          bmcHoverBtn.classList.remove('visible');
        }
      });

      bmcHoverBtn.addEventListener('click', () => {
        window.open('https://www.buymeacoffee.com/MovieDckWFPH', '_blank', 'noopener');
        console.log('Buy Me a Coffee hover button clicked');
      });

      document.getElementById('back-to-top').addEventListener('click', () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      const switchModeDebounced = throttle(switchMode, 300);
      document.getElementById('nav-movies').onclick = function (e) {
        e.preventDefault();
        console.log('[nav-movies] Clicked');
        switchModeDebounced('popular');
      };
      document.getElementById('nav-tvshows').onclick = function (e) {
        e.preventDefault();
        console.log('[nav-tvshows] Clicked');
        switchModeDebounced('tv');
      };
      document.getElementById('nav-anime').onclick = function (e) {
        e.preventDefault();
        console.log('[nav-anime] Clicked');
        switchModeDebounced('anime');
      };
      document.getElementById('nav-tagalog').onclick = function (e) {
        e.preventDefault();
        console.log('[nav-tagalog] Clicked');
        switchModeDebounced('tagalog');
      };
      document.getElementById('nav-favorites').onclick = function (e) {
        e.preventDefault();
        console.log('[nav-favorites] Clicked');
        switchModeDebounced('favorites');
      };
      document.getElementById('nav-netflix').onclick = function (e) {
        e.preventDefault();
        console.log('[nav-netflix] Clicked');
        let nav = document.getElementById('nav-netflix').parentNode;
        if (!document.getElementById("netflix-switcher")) {
          let switcher = document.createElement("div");
          switcher.id = "netflix-switcher";
          switcher.style = "margin-top: 6px; margin-bottom: 2px;";
          switcher.innerHTML = `<button id="netflix-movie-btn" class="btn btn-danger btn-sm" style="margin-right: 7px;">Movies</button>
            <button id="netflix-tv-btn" class="btn btn-danger btn-sm">TV Shows</button>`;
          nav.appendChild(switcher);
          document.getElementById("netflix-movie-btn").onclick = function () {
            netflixType = "movie";
            switchModeDebounced('netflix');
          };
          document.getElementById("netflix-tv-btn").onclick = function () {
            netflixType = "tv";
            switchModeDebounced('netflix');
          };
        }
        switchModeDebounced('netflix');
      };

      document.getElementById('movie-search-form').onsubmit = debounce(async function (e) {
        e.preventDefault();
        const form = document.getElementById('movie-search-form');
        const query = document.getElementById('movie-search-input').value.trim();
        if (!query) {
          movieList.innerHTML = `<div class="empty-state">Please enter a search query.</div>`;
          return;
        }
        console.log('[movie-search-form] Search query:', query);
        form.classList.add('loading');
        currentQuery = query;
        currentGenre = "";
        currentYear = "";
        document.getElementById('genre-filter').value = "";
        document.getElementById('year-filter').value = "";
        await switchMode('search');
        form.classList.remove('loading');
      }, 300);

      document.getElementById('movie-search-input').oninput = function () {
        if (!this.value.trim()) {
          console.log('[movie-search-input] Input cleared, resetting to popular');
          currentQuery = '';
          switchMode('popular');
        }
      };

      document.getElementById('genre-filter').onchange = function () {
        currentGenre = this.value;
        console.log('[genre-filter] Changed to:', currentGenre);
        resetInfiniteScroll();
      };
      document.getElementById('year-filter').onchange = function () {
        currentYear = this.value;
        console.log('[year-filter] Changed to:', currentYear);
        resetInfiniteScroll();
      };
      document.getElementById('clear-genre-btn').onclick = function () {
        currentGenre = "";
        currentYear = "";
        document.getElementById('genre-filter').value = "";
        document.getElementById('year-filter').value = "";
        console.log('[clear-genre-btn] Cleared filters');
        resetInfiniteScroll();
      };

      window.addEventListener('scroll', throttle(() => {
        if (currentMode === 'favorites') return;
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
        if (scrollTop + clientHeight >= scrollHeight - 300 && !isLoading && !reachedEnd) {
          loadMoreMovies();
        }
      }, 200));

      window.addEventListener('touchend', () => {
        if (currentMode === 'favorites') return;
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
        if (scrollTop + clientHeight >= scrollHeight - 300 && !isLoading && !reachedEnd) {
          console.log('[touchend] Triggering loadMoreMovies');
          loadMoreMovies();
        }
      });

      renderRecentlyViewed();
      resetInfiniteScroll();
    });

    document.getElementById('modal').onclick = function (e) {
      if (e.target === this) closeModal();
    };
  </script>
</body>
</html>